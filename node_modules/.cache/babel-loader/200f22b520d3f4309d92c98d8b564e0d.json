{"ast":null,"code":"/**\r\n * DevExtreme (exporter/image_creator.js)\r\n * Version: 19.2.7\r\n * Build date: Thu Mar 26 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _color = require(\"../color\");\n\nvar _color2 = _interopRequireDefault(_color);\n\nvar _type = require(\"../core/utils/type\");\n\nvar _svg = require(\"../core/utils/svg\");\n\nvar _svg2 = _interopRequireDefault(_svg);\n\nvar _iterator = require(\"../core/utils/iterator\");\n\nvar _extend = require(\"../core/utils/extend\");\n\nvar _dom_adapter = require(\"../core/dom_adapter\");\n\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\n\nvar _dom = require(\"../core/utils/dom\");\n\nvar _dom2 = _interopRequireDefault(_dom);\n\nvar _window = require(\"../core/utils/window\");\n\nvar _window2 = _interopRequireDefault(_window);\n\nvar _inflector = require(\"../core/utils/inflector\");\n\nvar _deferred = require(\"../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar window = _window2.default.getWindow();\n\nvar _math = Math;\nvar PI = _math.PI;\nvar _min = _math.min;\nvar _abs = _math.abs;\nvar _sqrt = _math.sqrt;\nvar _pow = _math.pow;\nvar _atan2 = _math.atan2;\nvar _cos = _math.cos;\nvar _sin = _math.sin;\nvar _number = Number;\nvar IMAGE_QUALITY = 1;\nvar TEXT_DECORATION_LINE_WIDTH_COEFF = .05;\nvar DEFAULT_FONT_SIZE = \"10px\";\nvar DEFAULT_FONT_FAMILY = \"sans-serif\";\nvar DEFAULT_TEXT_COLOR = \"#000\";\n\nfunction createCanvas(width, height, margin) {\n  var canvas = (0, _renderer2.default)(\"<canvas>\")[0];\n  canvas.width = width + 2 * margin;\n  canvas.height = height + 2 * margin;\n  canvas.hidden = true;\n  return canvas;\n}\n\nfunction getStringFromCanvas(canvas, mimeType) {\n  var dataURL = canvas.toDataURL(mimeType, IMAGE_QUALITY);\n  var imageData = window.atob(dataURL.substring((\"data:\" + mimeType + \";base64,\").length));\n  return imageData;\n}\n\nfunction arcTo(x1, y1, x2, y2, radius, largeArcFlag, clockwise, context) {\n  var cBx = (x1 + x2) / 2;\n  var cBy = (y1 + y2) / 2;\n\n  var aB = _atan2(y1 - y2, x1 - x2);\n\n  var k = largeArcFlag ? 1 : -1;\n  var opSide;\n  var adjSide;\n  var centerX;\n  var centerY;\n  var startAngle;\n  var endAngle;\n  aB += 90 * (PI / 180) * (clockwise ? 1 : -1);\n  opSide = _sqrt(_pow(x2 - x1, 2) + _pow(y2 - y1, 2)) / 2;\n  adjSide = _sqrt(_abs(_pow(radius, 2) - _pow(opSide, 2)));\n  centerX = cBx + k * (adjSide * _cos(aB));\n  centerY = cBy + k * (adjSide * _sin(aB));\n  startAngle = _atan2(y1 - centerY, x1 - centerX);\n  endAngle = _atan2(y2 - centerY, x2 - centerX);\n  context.arc(centerX, centerY, radius, startAngle, endAngle, !clockwise);\n}\n\nfunction getElementOptions(element, rootAppended) {\n  var attr = parseAttributes(element.attributes || {});\n  var options = (0, _extend.extend)({}, attr, {\n    text: element.textContent.replace(/\\s+/g, \" \"),\n    textAlign: \"middle\" === attr[\"text-anchor\"] ? \"center\" : attr[\"text-anchor\"]\n  });\n  var transform = attr.transform;\n  var coords;\n\n  if (transform) {\n    coords = transform.match(/translate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\n\n    if (coords) {\n      coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\n      options.translateX = _number(coords[0]);\n      options.translateY = coords[1] ? _number(coords[1]) : 0;\n    }\n\n    coords = transform.match(/rotate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*,*\\s*-*\\d+([.]\\d+)*)*/);\n\n    if (coords) {\n      coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\n      options.rotationAngle = _number(coords[0]);\n      options.rotationX = coords[1] && _number(coords[1]);\n      options.rotationY = coords[2] && _number(coords[2]);\n    }\n\n    coords = transform.match(/scale\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\n\n    if (coords) {\n      coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\n      options.scaleX = _number(coords[0]);\n\n      if (coords.length > 1) {\n        options.scaleY = _number(coords[1]);\n      } else {\n        options.scaleY = options.scaleX;\n      }\n    }\n  }\n\n  parseStyles(element, options, rootAppended);\n  return options;\n}\n\nfunction drawRect(context, options) {\n  var x = options.x;\n  var y = options.y;\n  var width = options.width;\n  var height = options.height;\n  var cornerRadius = options.rx;\n\n  if (!cornerRadius) {\n    context.rect(x, y, width, height);\n  } else {\n    cornerRadius = _min(cornerRadius, width / 2, height / 2);\n    context.save();\n    context.translate(x, y);\n    context.moveTo(width / 2, 0);\n    context.arcTo(width, 0, width, height, cornerRadius);\n    context.arcTo(width, height, 0, height, cornerRadius);\n    context.arcTo(0, height, 0, 0, cornerRadius);\n    context.arcTo(0, 0, cornerRadius, 0, cornerRadius);\n    context.lineTo(width / 2, 0);\n    context.restore();\n  }\n}\n\nfunction drawImage(context, options, shared) {\n  var d = new _deferred.Deferred();\n  var image = new window.Image();\n\n  image.onload = function () {\n    context.save();\n    context.globalAlpha = options.globalAlpha;\n    transformElement(context, options);\n    clipElement(context, options, shared);\n    context.drawImage(image, options.x, options.y, options.width, options.height);\n    context.restore();\n    d.resolve();\n  };\n\n  image.onerror = function () {\n    d.resolve();\n  };\n\n  image.setAttribute(\"crossOrigin\", \"anonymous\");\n  image.src = options.href || options[\"xlink:href\"];\n  return d;\n}\n\nfunction drawPath(context, dAttr) {\n  var dArray = dAttr.replace(/,/g, \" \").split(/([A-Z])/i).filter(function (item) {\n    return \"\" !== item.trim();\n  });\n  var i = 0;\n  var params;\n  var prevParams;\n  var prevParamsLen;\n\n  do {\n    params = (dArray[i + 1] || \"\").trim().split(\" \");\n\n    switch (dArray[i]) {\n      case \"M\":\n        context.moveTo(_number(params[0]), _number(params[1]));\n        i += 2;\n        break;\n\n      case \"L\":\n        for (var j = 0; j < params.length / 2; j++) {\n          context.lineTo(_number(params[2 * j]), _number(params[2 * j + 1]));\n        }\n\n        i += 2;\n        break;\n\n      case \"C\":\n        context.bezierCurveTo(_number(params[0]), _number(params[1]), _number(params[2]), _number(params[3]), _number(params[4]), _number(params[5]));\n        i += 2;\n        break;\n\n      case \"a\":\n        prevParams = dArray[i - 1].trim().split(\" \");\n        prevParamsLen = prevParams.length - 1;\n        arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(prevParams[prevParamsLen - 1]) + _number(params[5]), _number(prevParams[prevParamsLen]) + _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\n        i += 2;\n        break;\n\n      case \"A\":\n        prevParams = dArray[i - 1].trim().split(\" \");\n        prevParamsLen = prevParams.length - 1;\n        arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(params[5]), _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\n        i += 2;\n        break;\n\n      case \"Z\":\n        context.closePath();\n        i += 1;\n        break;\n\n      default:\n        i++;\n    }\n  } while (i < dArray.length);\n}\n\nfunction parseStyles(element, options, rootAppended) {\n  var style = element.style || {};\n  var field;\n\n  for (field in style) {\n    if (\"\" !== style[field]) {\n      options[(0, _inflector.camelize)(field)] = style[field];\n    }\n  }\n\n  if (rootAppended && _dom_adapter2.default.isElementNode(element)) {\n    style = window.getComputedStyle(element);\n    [\"fill\", \"stroke\", \"stroke-width\", \"font-family\", \"font-size\", \"font-style\", \"font-weight\"].forEach(function (prop) {\n      if (prop in style && \"\" !== style[prop]) {\n        options[(0, _inflector.camelize)(prop)] = style[prop];\n      }\n    });\n    [\"opacity\", \"fill-opacity\", \"stroke-opacity\"].forEach(function (prop) {\n      if (prop in style && \"\" !== style[prop] && \"1\" !== style[prop]) {\n        options[prop] = _number(style[prop]);\n      }\n    });\n  }\n\n  options.textDecoration = options.textDecoration || options.textDecorationLine;\n  options.globalAlpha = (0, _type.isDefined)(options.opacity) ? options.opacity : options.globalAlpha;\n}\n\nfunction parseUrl(urlString) {\n  var matches = urlString && urlString.match(/url\\(.*#(.*?)[\"']?\\)/i);\n  return matches && matches[1];\n}\n\nfunction setFontStyle(context, options) {\n  var fontParams = [];\n  options.fontSize = options.fontSize || DEFAULT_FONT_SIZE;\n  options.fontFamily || DEFAULT_FONT_FAMILY;\n  options.fill = options.fill || DEFAULT_TEXT_COLOR;\n  options.fontStyle && fontParams.push(options.fontStyle);\n  options.fontWeight && fontParams.push(options.fontWeight);\n  fontParams.push(options.fontSize);\n  fontParams.push(options.fontFamily);\n  context.font = fontParams.join(\" \");\n  context.textAlign = options.textAlign;\n  context.fillStyle = options.fill;\n  context.globalAlpha = options.globalAlpha;\n}\n\nfunction drawText(context, options, shared) {\n  setFontStyle(context, options);\n  applyFilter(context, options, shared);\n  options.text && context.fillText(options.text, options.x || 0, options.y || 0);\n  strokeElement(context, options, true);\n  drawTextDecoration(context, options, shared);\n}\n\nfunction drawTextDecoration(context, options, shared) {\n  if (!options.textDecoration || \"none\" === options.textDecoration) {\n    return;\n  }\n\n  var x = options.x;\n  var textWidth = context.measureText(options.text).width;\n  var textHeight = parseInt(options.fontSize, 10);\n  var lineHeight = textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF < 1 ? 1 : textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF;\n  var y = options.y;\n\n  switch (options.textDecoration) {\n    case \"line-through\":\n      y -= textHeight / 3 + lineHeight / 2;\n      break;\n\n    case \"overline\":\n      y -= textHeight - lineHeight;\n      break;\n\n    case \"underline\":\n      y += lineHeight;\n  }\n\n  context.rect(x, y, textWidth, lineHeight);\n  fillElement(context, options, shared);\n  strokeElement(context, options);\n}\n\nfunction aggregateOpacity(options) {\n  options.strokeOpacity = void 0 !== options[\"stroke-opacity\"] ? options[\"stroke-opacity\"] : 1;\n  options.fillOpacity = void 0 !== options[\"fill-opacity\"] ? options[\"fill-opacity\"] : 1;\n\n  if (void 0 !== options.opacity) {\n    options.strokeOpacity *= options.opacity;\n    options.fillOpacity *= options.opacity;\n  }\n}\n\nfunction hasTspan(element) {\n  var nodes = element.childNodes;\n\n  for (var i = 0; i < nodes.length; i++) {\n    if (\"tspan\" === nodes[i].tagName) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction drawTextElement(childNodes, context, options, shared) {\n  var lines = [];\n  var line;\n  var offset = 0;\n\n  for (var i = 0; i < childNodes.length; i++) {\n    var element = childNodes[i];\n\n    if (void 0 === element.tagName) {\n      drawElement(element, context, options, shared);\n    } else {\n      if (\"tspan\" === element.tagName || \"text\" === element.tagName) {\n        var elementOptions = getElementOptions(element, shared.rootAppended);\n        var mergedOptions = (0, _extend.extend)({}, options, elementOptions);\n\n        if (\"tspan\" === element.tagName && hasTspan(element)) {\n          drawTextElement(element.childNodes, context, mergedOptions, shared);\n          continue;\n        }\n\n        mergedOptions.textAlign = \"start\";\n\n        if (!line || void 0 !== elementOptions.x) {\n          line = {\n            elements: [],\n            options: [],\n            widths: [],\n            offsets: []\n          };\n          lines.push(line);\n        }\n\n        if (void 0 !== elementOptions.y) {\n          offset = 0;\n        }\n\n        if (void 0 !== elementOptions.dy) {\n          offset += parseFloat(elementOptions.dy);\n        }\n\n        line.elements.push(element);\n        line.options.push(mergedOptions);\n        line.offsets.push(offset);\n        setFontStyle(context, mergedOptions);\n        line.widths.push(context.measureText(mergedOptions.text).width);\n      }\n    }\n  }\n\n  lines.forEach(function (line) {\n    var commonWidth = line.widths.reduce(function (commonWidth, width) {\n      return commonWidth + width;\n    }, 0);\n    var xDiff = 0;\n    var currentOffset = 0;\n\n    if (\"center\" === options.textAlign) {\n      xDiff = commonWidth / 2;\n    }\n\n    if (\"end\" === options.textAlign) {\n      xDiff = commonWidth;\n    }\n\n    line.options.forEach(function (o, index) {\n      var width = line.widths[index];\n      o.x = o.x - xDiff + currentOffset;\n      o.y += line.offsets[index];\n      currentOffset += width;\n    });\n    line.elements.forEach(function (element, index) {\n      drawTextElement(element.childNodes, context, line.options[index], shared);\n    });\n  });\n}\n\nfunction drawElement(element, context, parentOptions, shared) {\n  var tagName = element.tagName;\n  var isText = \"text\" === tagName || \"tspan\" === tagName || void 0 === tagName;\n  var isImage = \"image\" === tagName;\n  var options = (0, _extend.extend)({}, parentOptions, getElementOptions(element, shared.rootAppended));\n\n  if (\"hidden\" === options.visibility || options[\"hidden-for-export\"]) {\n    return;\n  }\n\n  context.save();\n  !isImage && transformElement(context, options);\n  clipElement(context, options, shared);\n  aggregateOpacity(options);\n  var promise;\n  context.beginPath();\n\n  switch (element.tagName) {\n    case void 0:\n      drawText(context, options, shared);\n      break;\n\n    case \"text\":\n    case \"tspan\":\n      drawTextElement(element.childNodes, context, options, shared);\n      break;\n\n    case \"image\":\n      promise = drawImage(context, options, shared);\n      break;\n\n    case \"path\":\n      drawPath(context, options.d);\n      break;\n\n    case \"rect\":\n      drawRect(context, options);\n      context.closePath();\n      break;\n\n    case \"circle\":\n      context.arc(options.cx, options.cy, options.r, 0, 2 * PI, 1);\n  }\n\n  if (!isText) {\n    applyFilter(context, options, shared);\n    fillElement(context, options, shared);\n    strokeElement(context, options);\n  }\n\n  applyGradient(context, options, shared, element);\n  context.restore();\n  return promise;\n}\n\nfunction applyGradient(context, options, _ref, element) {\n  var gradients = _ref.gradients;\n\n  if (0 === gradients.length) {\n    return;\n  }\n\n  var id = parseUrl(options.fill);\n\n  if (id && gradients[id]) {\n    var box = element.getBBox();\n    var gradient = context.createLinearGradient(box.x, 0, box.x + box.width, 0);\n    gradients[id].forEach(function (opt) {\n      var offset = parseInt(opt.offset.replace(/%/, \"\"));\n      gradient.addColorStop(offset / 100, opt.stopColor);\n    });\n    context.globalAlpha = options.opacity;\n    context.fillStyle = gradient;\n    context.fill();\n  }\n}\n\nfunction applyFilter(context, options, shared) {\n  var filterOptions;\n  var id = parseUrl(options.filter);\n\n  if (id) {\n    filterOptions = shared.filters[id];\n\n    if (!filterOptions) {\n      filterOptions = {\n        offsetX: 0,\n        offsetY: 0,\n        blur: 0,\n        color: \"#000\"\n      };\n    }\n\n    context.shadowOffsetX = filterOptions.offsetX;\n    context.shadowOffsetY = filterOptions.offsetY;\n    context.shadowColor = filterOptions.color;\n    context.shadowBlur = filterOptions.blur;\n  }\n}\n\nfunction transformElement(context, options) {\n  context.translate(options.translateX || 0, options.translateY || 0);\n  options.translateX = void 0;\n  options.translateY = void 0;\n\n  if (options.rotationAngle) {\n    context.translate(options.rotationX || 0, options.rotationY || 0);\n    context.rotate(options.rotationAngle * PI / 180);\n    context.translate(-(options.rotationX || 0), -(options.rotationY || 0));\n    options.rotationAngle = void 0;\n    options.rotationX = void 0;\n    options.rotationY = void 0;\n  }\n\n  if (isFinite(options.scaleX)) {\n    context.scale(options.scaleX, options.scaleY);\n    options.scaleX = void 0;\n    options.scaleY = void 0;\n  }\n}\n\nfunction clipElement(context, options, shared) {\n  if (options[\"clip-path\"]) {\n    drawElement(shared.clipPaths[parseUrl(options[\"clip-path\"])], context, {}, shared);\n    context.clip();\n    options[\"clip-path\"] = void 0;\n  }\n}\n\nfunction hex2rgba(hexColor, alpha) {\n  var color = new _color2.default(hexColor);\n  return \"rgba(\" + color.r + \",\" + color.g + \",\" + color.b + \",\" + alpha + \")\";\n}\n\nfunction createGradient(element) {\n  var options = [];\n  (0, _iterator.each)(element.childNodes, function (_, _ref2) {\n    var attributes = _ref2.attributes;\n    options.push({\n      offset: attributes.offset.value,\n      stopColor: attributes[\"stop-color\"].value\n    });\n  });\n  return options;\n}\n\nfunction createFilter(element) {\n  var color;\n  var opacity;\n  var filterOptions = {};\n  (0, _iterator.each)(element.childNodes, function (_, node) {\n    var attr = node.attributes;\n\n    if (!attr.result) {\n      return;\n    }\n\n    switch (attr.result.value) {\n      case \"gaussianBlurResult\":\n        filterOptions.blur = _number(attr.stdDeviation.value);\n        break;\n\n      case \"offsetResult\":\n        filterOptions.offsetX = _number(attr.dx.value);\n        filterOptions.offsetY = _number(attr.dy.value);\n        break;\n\n      case \"floodResult\":\n        color = attr[\"flood-color\"] ? attr[\"flood-color\"].value : \"#000\";\n        opacity = attr[\"flood-opacity\"] ? attr[\"flood-opacity\"].value : 1;\n        filterOptions.color = hex2rgba(color, opacity);\n    }\n  });\n  return filterOptions;\n}\n\nfunction asyncEach(array, callback) {\n  var d = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : new _deferred.Deferred();\n\n  if (0 === array.length) {\n    return d.resolve();\n  }\n\n  var result = callback(array[0]);\n\n  function next() {\n    asyncEach(Array.prototype.slice.call(array, 1), callback, d);\n  }\n\n  if ((0, _type.isPromise)(result)) {\n    result.then(next);\n  } else {\n    next();\n  }\n\n  return d;\n}\n\nfunction drawCanvasElements(elements, context, parentOptions, shared) {\n  return asyncEach(elements, function (element) {\n    switch (element.tagName && element.tagName.toLowerCase()) {\n      case \"g\":\n      case \"svg\":\n        var options = (0, _extend.extend)({}, parentOptions, getElementOptions(element, shared.rootAppended));\n        context.save();\n        transformElement(context, options);\n        clipElement(context, options, shared);\n\n        var onDone = function onDone() {\n          context.restore();\n        };\n\n        var d = drawCanvasElements(element.childNodes, context, options, shared);\n\n        if ((0, _type.isPromise)(d)) {\n          d.then(onDone);\n        } else {\n          onDone();\n        }\n\n        return d;\n\n      case \"defs\":\n        return drawCanvasElements(element.childNodes, context, {}, shared);\n\n      case \"clippath\":\n        shared.clipPaths[element.attributes.id.textContent] = element.childNodes[0];\n        break;\n\n      case \"pattern\":\n        shared.patterns[element.attributes.id.textContent] = element;\n        break;\n\n      case \"filter\":\n        shared.filters[element.id] = createFilter(element);\n        break;\n\n      case \"lineargradient\":\n        shared.gradients[element.attributes.id.textContent] = createGradient(element);\n        break;\n\n      default:\n        return drawElement(element, context, parentOptions, shared);\n    }\n  });\n}\n\nfunction setLineDash(context, options) {\n  var matches = options[\"stroke-dasharray\"] && options[\"stroke-dasharray\"].match(/(\\d+)/g);\n\n  if (matches && matches.length) {\n    matches = (0, _iterator.map)(matches, function (item) {\n      return _number(item);\n    });\n    context.setLineDash(matches);\n  }\n}\n\nfunction strokeElement(context, options, isText) {\n  var stroke = options.stroke;\n\n  if (stroke && \"none\" !== stroke && 0 !== options[\"stroke-width\"]) {\n    setLineDash(context, options);\n    context.lineJoin = options[\"stroke-linejoin\"];\n    context.lineWidth = options[\"stroke-width\"];\n    context.globalAlpha = options.strokeOpacity;\n    context.strokeStyle = stroke;\n    isText ? context.strokeText(options.text, options.x, options.y) : context.stroke();\n    context.globalAlpha = 1;\n  }\n}\n\nfunction getPattern(context, pattern, shared) {\n  var options = getElementOptions(pattern, shared.rootAppended);\n  var patternCanvas = createCanvas(options.width, options.height, 0);\n  var patternContext = patternCanvas.getContext(\"2d\");\n  drawCanvasElements(pattern.childNodes, patternContext, options, shared);\n  return context.createPattern(patternCanvas, \"repeat\");\n}\n\nfunction fillElement(context, options, shared) {\n  var fill = options.fill;\n\n  if (fill && \"none\" !== fill) {\n    if (fill.search(/url/) === -1) {\n      context.fillStyle = fill;\n    } else {\n      var pattern = shared.patterns[parseUrl(fill)];\n\n      if (!pattern) {\n        return;\n      }\n\n      context.fillStyle = getPattern(context, pattern, shared);\n    }\n\n    context.globalAlpha = options.fillOpacity;\n    context.fill();\n    context.globalAlpha = 1;\n  }\n}\n\nvar parseAttributes = function parseAttributes(attributes) {\n  var newAttributes = {};\n  var attr;\n  (0, _iterator.each)(attributes, function (index, item) {\n    attr = item.textContent;\n\n    if (isFinite(attr)) {\n      attr = _number(attr);\n    }\n\n    newAttributes[item.name.toLowerCase()] = attr;\n  });\n  return newAttributes;\n};\n\nfunction drawBackground(context, width, height, backgroundColor, margin) {\n  context.fillStyle = backgroundColor || \"#ffffff\";\n  context.fillRect(-margin, -margin, width + 2 * margin, height + 2 * margin);\n}\n\nfunction createInvisibleDiv() {\n  var invisibleDiv = _dom_adapter2.default.createElement(\"div\");\n\n  invisibleDiv.style.left = \"-9999px\";\n  invisibleDiv.style.position = \"absolute\";\n  return invisibleDiv;\n}\n\nfunction convertSvgToCanvas(svg, canvas, rootAppended) {\n  return drawCanvasElements(svg.childNodes, canvas.getContext(\"2d\"), {}, {\n    clipPaths: {},\n    patterns: {},\n    filters: {},\n    gradients: {},\n    rootAppended: rootAppended\n  });\n}\n\nfunction getCanvasFromSvg(markup, width, height, backgroundColor, margin) {\n  var svgToCanvas = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : convertSvgToCanvas;\n  var canvas = createCanvas(width, height, margin);\n  var context = canvas.getContext(\"2d\");\n\n  var svgElem = _svg2.default.getSvgElement(markup);\n\n  var invisibleDiv;\n\n  var markupIsDomElement = _dom_adapter2.default.isElementNode(markup);\n\n  context.translate(margin, margin);\n\n  _dom_adapter2.default.getBody().appendChild(canvas);\n\n  if (!markupIsDomElement) {\n    invisibleDiv = createInvisibleDiv();\n    invisibleDiv.appendChild(svgElem);\n\n    _dom_adapter2.default.getBody().appendChild(invisibleDiv);\n  }\n\n  if (svgElem.attributes.direction) {\n    canvas.dir = svgElem.attributes.direction.textContent;\n  }\n\n  drawBackground(context, width, height, backgroundColor, margin);\n  return (0, _deferred.fromPromise)(svgToCanvas(svgElem, canvas, markupIsDomElement && _dom2.default.contains(_dom_adapter2.default.getBody(), markup))).then(function () {\n    return canvas;\n  }).always(function () {\n    invisibleDiv && _dom_adapter2.default.getBody().removeChild(invisibleDiv);\n\n    _dom_adapter2.default.getBody().removeChild(canvas);\n  });\n}\n\nexports.imageCreator = {\n  getImageData: function getImageData(markup, options) {\n    var mimeType = \"image/\" + options.format;\n    var width = options.width;\n    var height = options.height;\n    var backgroundColor = options.backgroundColor;\n\n    if ((0, _type.isFunction)(options.__parseAttributesFn)) {\n      parseAttributes = options.__parseAttributesFn;\n    }\n\n    return getCanvasFromSvg(markup, width, height, backgroundColor, options.margin, options.svgToCanvas).then(function (canvas) {\n      return getStringFromCanvas(canvas, mimeType);\n    });\n  },\n  getData: function getData(markup, options) {\n    var that = this;\n    return exports.imageCreator.getImageData(markup, options).then(function (binaryData) {\n      var mimeType = \"image/\" + options.format;\n      var data = (0, _type.isFunction)(window.Blob) && !options.forceProxy ? that._getBlob(binaryData, mimeType) : that._getBase64(binaryData);\n      return data;\n    });\n  },\n  _getBlob: function _getBlob(binaryData, mimeType) {\n    var i;\n    var dataArray = new Uint8Array(binaryData.length);\n\n    for (i = 0; i < binaryData.length; i++) {\n      dataArray[i] = binaryData.charCodeAt(i);\n    }\n\n    return new window.Blob([dataArray.buffer], {\n      type: mimeType\n    });\n  },\n  _getBase64: function _getBase64(binaryData) {\n    return window.btoa(binaryData);\n  }\n};\n\nexports.getData = function (data, options) {\n  return exports.imageCreator.getData(data, options);\n};\n\nexports.testFormats = function (formats) {\n  var canvas = createCanvas(100, 100, 0);\n  return formats.reduce(function (r, f) {\n    var mimeType = (\"image/\" + f).toLowerCase();\n\n    if (canvas.toDataURL(mimeType).indexOf(mimeType) !== -1) {\n      r.supported.push(f);\n    } else {\n      r.unsupported.push(f);\n    }\n\n    return r;\n  }, {\n    supported: [],\n    unsupported: []\n  });\n};","map":{"version":3,"sources":["C:/Users/va112/Documents/Webdev/React/Corona/node_modules/devextreme/exporter/image_creator.js"],"names":["_renderer","require","_renderer2","_interopRequireDefault","_color","_color2","_type","_svg","_svg2","_iterator","_extend","_dom_adapter","_dom_adapter2","_dom","_dom2","_window","_window2","_inflector","_deferred","obj","__esModule","window","default","getWindow","_math","Math","PI","_min","min","_abs","abs","_sqrt","sqrt","_pow","pow","_atan2","atan2","_cos","cos","_sin","sin","_number","Number","IMAGE_QUALITY","TEXT_DECORATION_LINE_WIDTH_COEFF","DEFAULT_FONT_SIZE","DEFAULT_FONT_FAMILY","DEFAULT_TEXT_COLOR","createCanvas","width","height","margin","canvas","hidden","getStringFromCanvas","mimeType","dataURL","toDataURL","imageData","atob","substring","length","arcTo","x1","y1","x2","y2","radius","largeArcFlag","clockwise","context","cBx","cBy","aB","k","opSide","adjSide","centerX","centerY","startAngle","endAngle","arc","getElementOptions","element","rootAppended","attr","parseAttributes","attributes","options","extend","text","textContent","replace","textAlign","transform","coords","match","translateX","translateY","rotationAngle","rotationX","rotationY","scaleX","scaleY","parseStyles","drawRect","x","y","cornerRadius","rx","rect","save","translate","moveTo","lineTo","restore","drawImage","shared","d","Deferred","image","Image","onload","globalAlpha","transformElement","clipElement","resolve","onerror","setAttribute","src","href","drawPath","dAttr","dArray","split","filter","item","trim","i","params","prevParams","prevParamsLen","j","bezierCurveTo","closePath","style","field","camelize","isElementNode","getComputedStyle","forEach","prop","textDecoration","textDecorationLine","isDefined","opacity","parseUrl","urlString","matches","setFontStyle","fontParams","fontSize","fontFamily","fill","fontStyle","push","fontWeight","font","join","fillStyle","drawText","applyFilter","fillText","strokeElement","drawTextDecoration","textWidth","measureText","textHeight","parseInt","lineHeight","fillElement","aggregateOpacity","strokeOpacity","fillOpacity","hasTspan","nodes","childNodes","tagName","drawTextElement","lines","line","offset","drawElement","elementOptions","mergedOptions","elements","widths","offsets","dy","parseFloat","commonWidth","reduce","xDiff","currentOffset","o","index","parentOptions","isText","isImage","visibility","promise","beginPath","cx","cy","r","applyGradient","_ref","gradients","id","box","getBBox","gradient","createLinearGradient","opt","addColorStop","stopColor","filterOptions","filters","offsetX","offsetY","blur","color","shadowOffsetX","shadowOffsetY","shadowColor","shadowBlur","rotate","isFinite","scale","clipPaths","clip","hex2rgba","hexColor","alpha","g","b","createGradient","each","_","_ref2","value","createFilter","node","result","stdDeviation","dx","asyncEach","array","callback","arguments","next","Array","prototype","slice","call","isPromise","then","drawCanvasElements","toLowerCase","onDone","patterns","setLineDash","map","stroke","lineJoin","lineWidth","strokeStyle","strokeText","getPattern","pattern","patternCanvas","patternContext","getContext","createPattern","search","newAttributes","name","drawBackground","backgroundColor","fillRect","createInvisibleDiv","invisibleDiv","createElement","left","position","convertSvgToCanvas","svg","getCanvasFromSvg","markup","svgToCanvas","svgElem","getSvgElement","markupIsDomElement","getBody","appendChild","direction","dir","fromPromise","contains","always","removeChild","exports","imageCreator","getImageData","format","isFunction","__parseAttributesFn","getData","that","binaryData","data","Blob","forceProxy","_getBlob","_getBase64","dataArray","Uint8Array","charCodeAt","buffer","type","btoa","testFormats","formats","f","indexOf","supported","unsupported"],"mappings":"AAAA;;;;;;;;AAQA;;AACA,IAAIA,SAAS,GAAGC,OAAO,CAAC,kBAAD,CAAvB;;AACA,IAAIC,UAAU,GAAGC,sBAAsB,CAACH,SAAD,CAAvC;;AACA,IAAII,MAAM,GAAGH,OAAO,CAAC,UAAD,CAApB;;AACA,IAAII,OAAO,GAAGF,sBAAsB,CAACC,MAAD,CAApC;;AACA,IAAIE,KAAK,GAAGL,OAAO,CAAC,oBAAD,CAAnB;;AACA,IAAIM,IAAI,GAAGN,OAAO,CAAC,mBAAD,CAAlB;;AACA,IAAIO,KAAK,GAAGL,sBAAsB,CAACI,IAAD,CAAlC;;AACA,IAAIE,SAAS,GAAGR,OAAO,CAAC,wBAAD,CAAvB;;AACA,IAAIS,OAAO,GAAGT,OAAO,CAAC,sBAAD,CAArB;;AACA,IAAIU,YAAY,GAAGV,OAAO,CAAC,qBAAD,CAA1B;;AACA,IAAIW,aAAa,GAAGT,sBAAsB,CAACQ,YAAD,CAA1C;;AACA,IAAIE,IAAI,GAAGZ,OAAO,CAAC,mBAAD,CAAlB;;AACA,IAAIa,KAAK,GAAGX,sBAAsB,CAACU,IAAD,CAAlC;;AACA,IAAIE,OAAO,GAAGd,OAAO,CAAC,sBAAD,CAArB;;AACA,IAAIe,QAAQ,GAAGb,sBAAsB,CAACY,OAAD,CAArC;;AACA,IAAIE,UAAU,GAAGhB,OAAO,CAAC,yBAAD,CAAxB;;AACA,IAAIiB,SAAS,GAAGjB,OAAO,CAAC,wBAAD,CAAvB;;AAEA,SAASE,sBAAT,CAAgCgB,GAAhC,EAAqC;AACjC,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AACD,IAAIE,MAAM,GAAGL,QAAQ,CAACM,OAAT,CAAiBC,SAAjB,EAAb;;AACA,IAAIC,KAAK,GAAGC,IAAZ;AACA,IAAIC,EAAE,GAAGF,KAAK,CAACE,EAAf;AACA,IAAIC,IAAI,GAAGH,KAAK,CAACI,GAAjB;AACA,IAAIC,IAAI,GAAGL,KAAK,CAACM,GAAjB;AACA,IAAIC,KAAK,GAAGP,KAAK,CAACQ,IAAlB;AACA,IAAIC,IAAI,GAAGT,KAAK,CAACU,GAAjB;AACA,IAAIC,MAAM,GAAGX,KAAK,CAACY,KAAnB;AACA,IAAIC,IAAI,GAAGb,KAAK,CAACc,GAAjB;AACA,IAAIC,IAAI,GAAGf,KAAK,CAACgB,GAAjB;AACA,IAAIC,OAAO,GAAGC,MAAd;AACA,IAAIC,aAAa,GAAG,CAApB;AACA,IAAIC,gCAAgC,GAAG,GAAvC;AACA,IAAIC,iBAAiB,GAAG,MAAxB;AACA,IAAIC,mBAAmB,GAAG,YAA1B;AACA,IAAIC,kBAAkB,GAAG,MAAzB;;AAEA,SAASC,YAAT,CAAsBC,KAAtB,EAA6BC,MAA7B,EAAqCC,MAArC,EAA6C;AACzC,MAAIC,MAAM,GAAG,CAAC,GAAGlD,UAAU,CAACoB,OAAf,EAAwB,UAAxB,EAAoC,CAApC,CAAb;AACA8B,EAAAA,MAAM,CAACH,KAAP,GAAeA,KAAK,GAAG,IAAIE,MAA3B;AACAC,EAAAA,MAAM,CAACF,MAAP,GAAgBA,MAAM,GAAG,IAAIC,MAA7B;AACAC,EAAAA,MAAM,CAACC,MAAP,GAAgB,IAAhB;AACA,SAAOD,MAAP;AACH;;AAED,SAASE,mBAAT,CAA6BF,MAA7B,EAAqCG,QAArC,EAA+C;AAC3C,MAAIC,OAAO,GAAGJ,MAAM,CAACK,SAAP,CAAiBF,QAAjB,EAA2BZ,aAA3B,CAAd;AACA,MAAIe,SAAS,GAAGrC,MAAM,CAACsC,IAAP,CAAYH,OAAO,CAACI,SAAR,CAAkB,CAAC,UAAUL,QAAV,GAAqB,UAAtB,EAAkCM,MAApD,CAAZ,CAAhB;AACA,SAAOH,SAAP;AACH;;AAED,SAASI,KAAT,CAAeC,EAAf,EAAmBC,EAAnB,EAAuBC,EAAvB,EAA2BC,EAA3B,EAA+BC,MAA/B,EAAuCC,YAAvC,EAAqDC,SAArD,EAAgEC,OAAhE,EAAyE;AACrE,MAAIC,GAAG,GAAG,CAACR,EAAE,GAAGE,EAAN,IAAY,CAAtB;AACA,MAAIO,GAAG,GAAG,CAACR,EAAE,GAAGE,EAAN,IAAY,CAAtB;;AACA,MAAIO,EAAE,GAAGtC,MAAM,CAAC6B,EAAE,GAAGE,EAAN,EAAUH,EAAE,GAAGE,EAAf,CAAf;;AACA,MAAIS,CAAC,GAAGN,YAAY,GAAG,CAAH,GAAO,CAAC,CAA5B;AACA,MAAIO,MAAJ;AACA,MAAIC,OAAJ;AACA,MAAIC,OAAJ;AACA,MAAIC,OAAJ;AACA,MAAIC,UAAJ;AACA,MAAIC,QAAJ;AACAP,EAAAA,EAAE,IAAI,MAAM/C,EAAE,GAAG,GAAX,KAAmB2C,SAAS,GAAG,CAAH,GAAO,CAAC,CAApC,CAAN;AACAM,EAAAA,MAAM,GAAG5C,KAAK,CAACE,IAAI,CAACgC,EAAE,GAAGF,EAAN,EAAU,CAAV,CAAJ,GAAmB9B,IAAI,CAACiC,EAAE,GAAGF,EAAN,EAAU,CAAV,CAAxB,CAAL,GAA6C,CAAtD;AACAY,EAAAA,OAAO,GAAG7C,KAAK,CAACF,IAAI,CAACI,IAAI,CAACkC,MAAD,EAAS,CAAT,CAAJ,GAAkBlC,IAAI,CAAC0C,MAAD,EAAS,CAAT,CAAvB,CAAL,CAAf;AACAE,EAAAA,OAAO,GAAGN,GAAG,GAAGG,CAAC,IAAIE,OAAO,GAAGvC,IAAI,CAACoC,EAAD,CAAlB,CAAjB;AACAK,EAAAA,OAAO,GAAGN,GAAG,GAAGE,CAAC,IAAIE,OAAO,GAAGrC,IAAI,CAACkC,EAAD,CAAlB,CAAjB;AACAM,EAAAA,UAAU,GAAG5C,MAAM,CAAC6B,EAAE,GAAGc,OAAN,EAAef,EAAE,GAAGc,OAApB,CAAnB;AACAG,EAAAA,QAAQ,GAAG7C,MAAM,CAAC+B,EAAE,GAAGY,OAAN,EAAeb,EAAE,GAAGY,OAApB,CAAjB;AACAP,EAAAA,OAAO,CAACW,GAAR,CAAYJ,OAAZ,EAAqBC,OAArB,EAA8BX,MAA9B,EAAsCY,UAAtC,EAAkDC,QAAlD,EAA4D,CAACX,SAA7D;AACH;;AAED,SAASa,iBAAT,CAA2BC,OAA3B,EAAoCC,YAApC,EAAkD;AAC9C,MAAIC,IAAI,GAAGC,eAAe,CAACH,OAAO,CAACI,UAAR,IAAsB,EAAvB,CAA1B;AACA,MAAIC,OAAO,GAAG,CAAC,GAAG9E,OAAO,CAAC+E,MAAZ,EAAoB,EAApB,EAAwBJ,IAAxB,EAA8B;AACxCK,IAAAA,IAAI,EAAEP,OAAO,CAACQ,WAAR,CAAoBC,OAApB,CAA4B,MAA5B,EAAoC,GAApC,CADkC;AAExCC,IAAAA,SAAS,EAAE,aAAaR,IAAI,CAAC,aAAD,CAAjB,GAAmC,QAAnC,GAA8CA,IAAI,CAAC,aAAD;AAFrB,GAA9B,CAAd;AAIA,MAAIS,SAAS,GAAGT,IAAI,CAACS,SAArB;AACA,MAAIC,MAAJ;;AACA,MAAID,SAAJ,EAAe;AACXC,IAAAA,MAAM,GAAGD,SAAS,CAACE,KAAV,CAAgB,iDAAhB,CAAT;;AACA,QAAID,MAAJ,EAAY;AACRA,MAAAA,MAAM,GAAGA,MAAM,CAAC,CAAD,CAAN,CAAUC,KAAV,CAAgB,iBAAhB,CAAT;AACAR,MAAAA,OAAO,CAACS,UAAR,GAAqBxD,OAAO,CAACsD,MAAM,CAAC,CAAD,CAAP,CAA5B;AACAP,MAAAA,OAAO,CAACU,UAAR,GAAqBH,MAAM,CAAC,CAAD,CAAN,GAAYtD,OAAO,CAACsD,MAAM,CAAC,CAAD,CAAP,CAAnB,GAAiC,CAAtD;AACH;;AACDA,IAAAA,MAAM,GAAGD,SAAS,CAACE,KAAV,CAAgB,iEAAhB,CAAT;;AACA,QAAID,MAAJ,EAAY;AACRA,MAAAA,MAAM,GAAGA,MAAM,CAAC,CAAD,CAAN,CAAUC,KAAV,CAAgB,iBAAhB,CAAT;AACAR,MAAAA,OAAO,CAACW,aAAR,GAAwB1D,OAAO,CAACsD,MAAM,CAAC,CAAD,CAAP,CAA/B;AACAP,MAAAA,OAAO,CAACY,SAAR,GAAoBL,MAAM,CAAC,CAAD,CAAN,IAAatD,OAAO,CAACsD,MAAM,CAAC,CAAD,CAAP,CAAxC;AACAP,MAAAA,OAAO,CAACa,SAAR,GAAoBN,MAAM,CAAC,CAAD,CAAN,IAAatD,OAAO,CAACsD,MAAM,CAAC,CAAD,CAAP,CAAxC;AACH;;AACDA,IAAAA,MAAM,GAAGD,SAAS,CAACE,KAAV,CAAgB,6CAAhB,CAAT;;AACA,QAAID,MAAJ,EAAY;AACRA,MAAAA,MAAM,GAAGA,MAAM,CAAC,CAAD,CAAN,CAAUC,KAAV,CAAgB,iBAAhB,CAAT;AACAR,MAAAA,OAAO,CAACc,MAAR,GAAiB7D,OAAO,CAACsD,MAAM,CAAC,CAAD,CAAP,CAAxB;;AACA,UAAIA,MAAM,CAAClC,MAAP,GAAgB,CAApB,EAAuB;AACnB2B,QAAAA,OAAO,CAACe,MAAR,GAAiB9D,OAAO,CAACsD,MAAM,CAAC,CAAD,CAAP,CAAxB;AACH,OAFD,MAEO;AACHP,QAAAA,OAAO,CAACe,MAAR,GAAiBf,OAAO,CAACc,MAAzB;AACH;AACJ;AACJ;;AACDE,EAAAA,WAAW,CAACrB,OAAD,EAAUK,OAAV,EAAmBJ,YAAnB,CAAX;AACA,SAAOI,OAAP;AACH;;AAED,SAASiB,QAAT,CAAkBnC,OAAlB,EAA2BkB,OAA3B,EAAoC;AAChC,MAAIkB,CAAC,GAAGlB,OAAO,CAACkB,CAAhB;AACA,MAAIC,CAAC,GAAGnB,OAAO,CAACmB,CAAhB;AACA,MAAI1D,KAAK,GAAGuC,OAAO,CAACvC,KAApB;AACA,MAAIC,MAAM,GAAGsC,OAAO,CAACtC,MAArB;AACA,MAAI0D,YAAY,GAAGpB,OAAO,CAACqB,EAA3B;;AACA,MAAI,CAACD,YAAL,EAAmB;AACftC,IAAAA,OAAO,CAACwC,IAAR,CAAaJ,CAAb,EAAgBC,CAAhB,EAAmB1D,KAAnB,EAA0BC,MAA1B;AACH,GAFD,MAEO;AACH0D,IAAAA,YAAY,GAAGjF,IAAI,CAACiF,YAAD,EAAe3D,KAAK,GAAG,CAAvB,EAA0BC,MAAM,GAAG,CAAnC,CAAnB;AACAoB,IAAAA,OAAO,CAACyC,IAAR;AACAzC,IAAAA,OAAO,CAAC0C,SAAR,CAAkBN,CAAlB,EAAqBC,CAArB;AACArC,IAAAA,OAAO,CAAC2C,MAAR,CAAehE,KAAK,GAAG,CAAvB,EAA0B,CAA1B;AACAqB,IAAAA,OAAO,CAACR,KAAR,CAAcb,KAAd,EAAqB,CAArB,EAAwBA,KAAxB,EAA+BC,MAA/B,EAAuC0D,YAAvC;AACAtC,IAAAA,OAAO,CAACR,KAAR,CAAcb,KAAd,EAAqBC,MAArB,EAA6B,CAA7B,EAAgCA,MAAhC,EAAwC0D,YAAxC;AACAtC,IAAAA,OAAO,CAACR,KAAR,CAAc,CAAd,EAAiBZ,MAAjB,EAAyB,CAAzB,EAA4B,CAA5B,EAA+B0D,YAA/B;AACAtC,IAAAA,OAAO,CAACR,KAAR,CAAc,CAAd,EAAiB,CAAjB,EAAoB8C,YAApB,EAAkC,CAAlC,EAAqCA,YAArC;AACAtC,IAAAA,OAAO,CAAC4C,MAAR,CAAejE,KAAK,GAAG,CAAvB,EAA0B,CAA1B;AACAqB,IAAAA,OAAO,CAAC6C,OAAR;AACH;AACJ;;AAED,SAASC,SAAT,CAAmB9C,OAAnB,EAA4BkB,OAA5B,EAAqC6B,MAArC,EAA6C;AACzC,MAAIC,CAAC,GAAG,IAAIpG,SAAS,CAACqG,QAAd,EAAR;AACA,MAAIC,KAAK,GAAG,IAAInG,MAAM,CAACoG,KAAX,EAAZ;;AACAD,EAAAA,KAAK,CAACE,MAAN,GAAe,YAAW;AACtBpD,IAAAA,OAAO,CAACyC,IAAR;AACAzC,IAAAA,OAAO,CAACqD,WAAR,GAAsBnC,OAAO,CAACmC,WAA9B;AACAC,IAAAA,gBAAgB,CAACtD,OAAD,EAAUkB,OAAV,CAAhB;AACAqC,IAAAA,WAAW,CAACvD,OAAD,EAAUkB,OAAV,EAAmB6B,MAAnB,CAAX;AACA/C,IAAAA,OAAO,CAAC8C,SAAR,CAAkBI,KAAlB,EAAyBhC,OAAO,CAACkB,CAAjC,EAAoClB,OAAO,CAACmB,CAA5C,EAA+CnB,OAAO,CAACvC,KAAvD,EAA8DuC,OAAO,CAACtC,MAAtE;AACAoB,IAAAA,OAAO,CAAC6C,OAAR;AACAG,IAAAA,CAAC,CAACQ,OAAF;AACH,GARD;;AASAN,EAAAA,KAAK,CAACO,OAAN,GAAgB,YAAW;AACvBT,IAAAA,CAAC,CAACQ,OAAF;AACH,GAFD;;AAGAN,EAAAA,KAAK,CAACQ,YAAN,CAAmB,aAAnB,EAAkC,WAAlC;AACAR,EAAAA,KAAK,CAACS,GAAN,GAAYzC,OAAO,CAAC0C,IAAR,IAAgB1C,OAAO,CAAC,YAAD,CAAnC;AACA,SAAO8B,CAAP;AACH;;AAED,SAASa,QAAT,CAAkB7D,OAAlB,EAA2B8D,KAA3B,EAAkC;AAC9B,MAAIC,MAAM,GAAGD,KAAK,CAACxC,OAAN,CAAc,IAAd,EAAoB,GAApB,EAAyB0C,KAAzB,CAA+B,UAA/B,EAA2CC,MAA3C,CAAkD,UAASC,IAAT,EAAe;AAC1E,WAAO,OAAOA,IAAI,CAACC,IAAL,EAAd;AACH,GAFY,CAAb;AAGA,MAAIC,CAAC,GAAG,CAAR;AACA,MAAIC,MAAJ;AACA,MAAIC,UAAJ;AACA,MAAIC,aAAJ;;AACA,KAAG;AACCF,IAAAA,MAAM,GAAG,CAACN,MAAM,CAACK,CAAC,GAAG,CAAL,CAAN,IAAiB,EAAlB,EAAsBD,IAAtB,GAA6BH,KAA7B,CAAmC,GAAnC,CAAT;;AACA,YAAQD,MAAM,CAACK,CAAD,CAAd;AACI,WAAK,GAAL;AACIpE,QAAAA,OAAO,CAAC2C,MAAR,CAAexE,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAAtB,EAAmClG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAA1C;AACAD,QAAAA,CAAC,IAAI,CAAL;AACA;;AACJ,WAAK,GAAL;AACI,aAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,MAAM,CAAC9E,MAAP,GAAgB,CAApC,EAAuCiF,CAAC,EAAxC,EAA4C;AACxCxE,UAAAA,OAAO,CAAC4C,MAAR,CAAezE,OAAO,CAACkG,MAAM,CAAC,IAAIG,CAAL,CAAP,CAAtB,EAAuCrG,OAAO,CAACkG,MAAM,CAAC,IAAIG,CAAJ,GAAQ,CAAT,CAAP,CAA9C;AACH;;AACDJ,QAAAA,CAAC,IAAI,CAAL;AACA;;AACJ,WAAK,GAAL;AACIpE,QAAAA,OAAO,CAACyE,aAAR,CAAsBtG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAA7B,EAA0ClG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAAjD,EAA8DlG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAArE,EAAkFlG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAAzF,EAAsGlG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAA7G,EAA0HlG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAAjI;AACAD,QAAAA,CAAC,IAAI,CAAL;AACA;;AACJ,WAAK,GAAL;AACIE,QAAAA,UAAU,GAAGP,MAAM,CAACK,CAAC,GAAG,CAAL,CAAN,CAAcD,IAAd,GAAqBH,KAArB,CAA2B,GAA3B,CAAb;AACAO,QAAAA,aAAa,GAAGD,UAAU,CAAC/E,MAAX,GAAoB,CAApC;AACAC,QAAAA,KAAK,CAACrB,OAAO,CAACmG,UAAU,CAACC,aAAa,GAAG,CAAjB,CAAX,CAAR,EAAyCpG,OAAO,CAACmG,UAAU,CAACC,aAAD,CAAX,CAAhD,EAA6EpG,OAAO,CAACmG,UAAU,CAACC,aAAa,GAAG,CAAjB,CAAX,CAAP,GAAyCpG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAA7H,EAA0IlG,OAAO,CAACmG,UAAU,CAACC,aAAD,CAAX,CAAP,GAAqCpG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAAtL,EAAmMlG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAA1M,EAAuNlG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAA9N,EAA2OlG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAAlP,EAA+PrE,OAA/P,CAAL;AACAoE,QAAAA,CAAC,IAAI,CAAL;AACA;;AACJ,WAAK,GAAL;AACIE,QAAAA,UAAU,GAAGP,MAAM,CAACK,CAAC,GAAG,CAAL,CAAN,CAAcD,IAAd,GAAqBH,KAArB,CAA2B,GAA3B,CAAb;AACAO,QAAAA,aAAa,GAAGD,UAAU,CAAC/E,MAAX,GAAoB,CAApC;AACAC,QAAAA,KAAK,CAACrB,OAAO,CAACmG,UAAU,CAACC,aAAa,GAAG,CAAjB,CAAX,CAAR,EAAyCpG,OAAO,CAACmG,UAAU,CAACC,aAAD,CAAX,CAAhD,EAA6EpG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAApF,EAAiGlG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAAxG,EAAqHlG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAA5H,EAAyIlG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAAhJ,EAA6JlG,OAAO,CAACkG,MAAM,CAAC,CAAD,CAAP,CAApK,EAAiLrE,OAAjL,CAAL;AACAoE,QAAAA,CAAC,IAAI,CAAL;AACA;;AACJ,WAAK,GAAL;AACIpE,QAAAA,OAAO,CAAC0E,SAAR;AACAN,QAAAA,CAAC,IAAI,CAAL;AACA;;AACJ;AACIA,QAAAA,CAAC;AAhCT;AAkCH,GApCD,QAoCSA,CAAC,GAAGL,MAAM,CAACxE,MApCpB;AAqCH;;AAED,SAAS2C,WAAT,CAAqBrB,OAArB,EAA8BK,OAA9B,EAAuCJ,YAAvC,EAAqD;AACjD,MAAI6D,KAAK,GAAG9D,OAAO,CAAC8D,KAAR,IAAiB,EAA7B;AACA,MAAIC,KAAJ;;AACA,OAAKA,KAAL,IAAcD,KAAd,EAAqB;AACjB,QAAI,OAAOA,KAAK,CAACC,KAAD,CAAhB,EAAyB;AACrB1D,MAAAA,OAAO,CAAC,CAAC,GAAGvE,UAAU,CAACkI,QAAf,EAAyBD,KAAzB,CAAD,CAAP,GAA2CD,KAAK,CAACC,KAAD,CAAhD;AACH;AACJ;;AACD,MAAI9D,YAAY,IAAIxE,aAAa,CAACU,OAAd,CAAsB8H,aAAtB,CAAoCjE,OAApC,CAApB,EAAkE;AAC9D8D,IAAAA,KAAK,GAAG5H,MAAM,CAACgI,gBAAP,CAAwBlE,OAAxB,CAAR;AACA,KAAC,MAAD,EAAS,QAAT,EAAmB,cAAnB,EAAmC,aAAnC,EAAkD,WAAlD,EAA+D,YAA/D,EAA6E,aAA7E,EAA4FmE,OAA5F,CAAoG,UAASC,IAAT,EAAe;AAC/G,UAAIA,IAAI,IAAIN,KAAR,IAAiB,OAAOA,KAAK,CAACM,IAAD,CAAjC,EAAyC;AACrC/D,QAAAA,OAAO,CAAC,CAAC,GAAGvE,UAAU,CAACkI,QAAf,EAAyBI,IAAzB,CAAD,CAAP,GAA0CN,KAAK,CAACM,IAAD,CAA/C;AACH;AACJ,KAJD;AAKA,KAAC,SAAD,EAAY,cAAZ,EAA4B,gBAA5B,EAA8CD,OAA9C,CAAsD,UAASC,IAAT,EAAe;AACjE,UAAIA,IAAI,IAAIN,KAAR,IAAiB,OAAOA,KAAK,CAACM,IAAD,CAA7B,IAAuC,QAAQN,KAAK,CAACM,IAAD,CAAxD,EAAgE;AAC5D/D,QAAAA,OAAO,CAAC+D,IAAD,CAAP,GAAgB9G,OAAO,CAACwG,KAAK,CAACM,IAAD,CAAN,CAAvB;AACH;AACJ,KAJD;AAKH;;AACD/D,EAAAA,OAAO,CAACgE,cAAR,GAAyBhE,OAAO,CAACgE,cAAR,IAA0BhE,OAAO,CAACiE,kBAA3D;AACAjE,EAAAA,OAAO,CAACmC,WAAR,GAAsB,CAAC,GAAGrH,KAAK,CAACoJ,SAAV,EAAqBlE,OAAO,CAACmE,OAA7B,IAAwCnE,OAAO,CAACmE,OAAhD,GAA0DnE,OAAO,CAACmC,WAAxF;AACH;;AAED,SAASiC,QAAT,CAAkBC,SAAlB,EAA6B;AACzB,MAAIC,OAAO,GAAGD,SAAS,IAAIA,SAAS,CAAC7D,KAAV,CAAgB,uBAAhB,CAA3B;AACA,SAAO8D,OAAO,IAAIA,OAAO,CAAC,CAAD,CAAzB;AACH;;AAED,SAASC,YAAT,CAAsBzF,OAAtB,EAA+BkB,OAA/B,EAAwC;AACpC,MAAIwE,UAAU,GAAG,EAAjB;AACAxE,EAAAA,OAAO,CAACyE,QAAR,GAAmBzE,OAAO,CAACyE,QAAR,IAAoBpH,iBAAvC;AACA2C,EAAAA,OAAO,CAAC0E,UAAR,IAAsBpH,mBAAtB;AACA0C,EAAAA,OAAO,CAAC2E,IAAR,GAAe3E,OAAO,CAAC2E,IAAR,IAAgBpH,kBAA/B;AACAyC,EAAAA,OAAO,CAAC4E,SAAR,IAAqBJ,UAAU,CAACK,IAAX,CAAgB7E,OAAO,CAAC4E,SAAxB,CAArB;AACA5E,EAAAA,OAAO,CAAC8E,UAAR,IAAsBN,UAAU,CAACK,IAAX,CAAgB7E,OAAO,CAAC8E,UAAxB,CAAtB;AACAN,EAAAA,UAAU,CAACK,IAAX,CAAgB7E,OAAO,CAACyE,QAAxB;AACAD,EAAAA,UAAU,CAACK,IAAX,CAAgB7E,OAAO,CAAC0E,UAAxB;AACA5F,EAAAA,OAAO,CAACiG,IAAR,GAAeP,UAAU,CAACQ,IAAX,CAAgB,GAAhB,CAAf;AACAlG,EAAAA,OAAO,CAACuB,SAAR,GAAoBL,OAAO,CAACK,SAA5B;AACAvB,EAAAA,OAAO,CAACmG,SAAR,GAAoBjF,OAAO,CAAC2E,IAA5B;AACA7F,EAAAA,OAAO,CAACqD,WAAR,GAAsBnC,OAAO,CAACmC,WAA9B;AACH;;AAED,SAAS+C,QAAT,CAAkBpG,OAAlB,EAA2BkB,OAA3B,EAAoC6B,MAApC,EAA4C;AACxC0C,EAAAA,YAAY,CAACzF,OAAD,EAAUkB,OAAV,CAAZ;AACAmF,EAAAA,WAAW,CAACrG,OAAD,EAAUkB,OAAV,EAAmB6B,MAAnB,CAAX;AACA7B,EAAAA,OAAO,CAACE,IAAR,IAAgBpB,OAAO,CAACsG,QAAR,CAAiBpF,OAAO,CAACE,IAAzB,EAA+BF,OAAO,CAACkB,CAAR,IAAa,CAA5C,EAA+ClB,OAAO,CAACmB,CAAR,IAAa,CAA5D,CAAhB;AACAkE,EAAAA,aAAa,CAACvG,OAAD,EAAUkB,OAAV,EAAmB,IAAnB,CAAb;AACAsF,EAAAA,kBAAkB,CAACxG,OAAD,EAAUkB,OAAV,EAAmB6B,MAAnB,CAAlB;AACH;;AAED,SAASyD,kBAAT,CAA4BxG,OAA5B,EAAqCkB,OAArC,EAA8C6B,MAA9C,EAAsD;AAClD,MAAI,CAAC7B,OAAO,CAACgE,cAAT,IAA2B,WAAWhE,OAAO,CAACgE,cAAlD,EAAkE;AAC9D;AACH;;AACD,MAAI9C,CAAC,GAAGlB,OAAO,CAACkB,CAAhB;AACA,MAAIqE,SAAS,GAAGzG,OAAO,CAAC0G,WAAR,CAAoBxF,OAAO,CAACE,IAA5B,EAAkCzC,KAAlD;AACA,MAAIgI,UAAU,GAAGC,QAAQ,CAAC1F,OAAO,CAACyE,QAAT,EAAmB,EAAnB,CAAzB;AACA,MAAIkB,UAAU,GAAGF,UAAU,GAAGrI,gCAAb,GAAgD,CAAhD,GAAoD,CAApD,GAAwDqI,UAAU,GAAGrI,gCAAtF;AACA,MAAI+D,CAAC,GAAGnB,OAAO,CAACmB,CAAhB;;AACA,UAAQnB,OAAO,CAACgE,cAAhB;AACI,SAAK,cAAL;AACI7C,MAAAA,CAAC,IAAIsE,UAAU,GAAG,CAAb,GAAiBE,UAAU,GAAG,CAAnC;AACA;;AACJ,SAAK,UAAL;AACIxE,MAAAA,CAAC,IAAIsE,UAAU,GAAGE,UAAlB;AACA;;AACJ,SAAK,WAAL;AACIxE,MAAAA,CAAC,IAAIwE,UAAL;AARR;;AAUA7G,EAAAA,OAAO,CAACwC,IAAR,CAAaJ,CAAb,EAAgBC,CAAhB,EAAmBoE,SAAnB,EAA8BI,UAA9B;AACAC,EAAAA,WAAW,CAAC9G,OAAD,EAAUkB,OAAV,EAAmB6B,MAAnB,CAAX;AACAwD,EAAAA,aAAa,CAACvG,OAAD,EAAUkB,OAAV,CAAb;AACH;;AAED,SAAS6F,gBAAT,CAA0B7F,OAA1B,EAAmC;AAC/BA,EAAAA,OAAO,CAAC8F,aAAR,GAAwB,KAAK,CAAL,KAAW9F,OAAO,CAAC,gBAAD,CAAlB,GAAuCA,OAAO,CAAC,gBAAD,CAA9C,GAAmE,CAA3F;AACAA,EAAAA,OAAO,CAAC+F,WAAR,GAAsB,KAAK,CAAL,KAAW/F,OAAO,CAAC,cAAD,CAAlB,GAAqCA,OAAO,CAAC,cAAD,CAA5C,GAA+D,CAArF;;AACA,MAAI,KAAK,CAAL,KAAWA,OAAO,CAACmE,OAAvB,EAAgC;AAC5BnE,IAAAA,OAAO,CAAC8F,aAAR,IAAyB9F,OAAO,CAACmE,OAAjC;AACAnE,IAAAA,OAAO,CAAC+F,WAAR,IAAuB/F,OAAO,CAACmE,OAA/B;AACH;AACJ;;AAED,SAAS6B,QAAT,CAAkBrG,OAAlB,EAA2B;AACvB,MAAIsG,KAAK,GAAGtG,OAAO,CAACuG,UAApB;;AACA,OAAK,IAAIhD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+C,KAAK,CAAC5H,MAA1B,EAAkC6E,CAAC,EAAnC,EAAuC;AACnC,QAAI,YAAY+C,KAAK,CAAC/C,CAAD,CAAL,CAASiD,OAAzB,EAAkC;AAC9B,aAAO,IAAP;AACH;AACJ;;AACD,SAAO,KAAP;AACH;;AAED,SAASC,eAAT,CAAyBF,UAAzB,EAAqCpH,OAArC,EAA8CkB,OAA9C,EAAuD6B,MAAvD,EAA+D;AAC3D,MAAIwE,KAAK,GAAG,EAAZ;AACA,MAAIC,IAAJ;AACA,MAAIC,MAAM,GAAG,CAAb;;AACA,OAAK,IAAIrD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgD,UAAU,CAAC7H,MAA/B,EAAuC6E,CAAC,EAAxC,EAA4C;AACxC,QAAIvD,OAAO,GAAGuG,UAAU,CAAChD,CAAD,CAAxB;;AACA,QAAI,KAAK,CAAL,KAAWvD,OAAO,CAACwG,OAAvB,EAAgC;AAC5BK,MAAAA,WAAW,CAAC7G,OAAD,EAAUb,OAAV,EAAmBkB,OAAnB,EAA4B6B,MAA5B,CAAX;AACH,KAFD,MAEO;AACH,UAAI,YAAYlC,OAAO,CAACwG,OAApB,IAA+B,WAAWxG,OAAO,CAACwG,OAAtD,EAA+D;AAC3D,YAAIM,cAAc,GAAG/G,iBAAiB,CAACC,OAAD,EAAUkC,MAAM,CAACjC,YAAjB,CAAtC;AACA,YAAI8G,aAAa,GAAG,CAAC,GAAGxL,OAAO,CAAC+E,MAAZ,EAAoB,EAApB,EAAwBD,OAAxB,EAAiCyG,cAAjC,CAApB;;AACA,YAAI,YAAY9G,OAAO,CAACwG,OAApB,IAA+BH,QAAQ,CAACrG,OAAD,CAA3C,EAAsD;AAClDyG,UAAAA,eAAe,CAACzG,OAAO,CAACuG,UAAT,EAAqBpH,OAArB,EAA8B4H,aAA9B,EAA6C7E,MAA7C,CAAf;AACA;AACH;;AACD6E,QAAAA,aAAa,CAACrG,SAAd,GAA0B,OAA1B;;AACA,YAAI,CAACiG,IAAD,IAAS,KAAK,CAAL,KAAWG,cAAc,CAACvF,CAAvC,EAA0C;AACtCoF,UAAAA,IAAI,GAAG;AACHK,YAAAA,QAAQ,EAAE,EADP;AAEH3G,YAAAA,OAAO,EAAE,EAFN;AAGH4G,YAAAA,MAAM,EAAE,EAHL;AAIHC,YAAAA,OAAO,EAAE;AAJN,WAAP;AAMAR,UAAAA,KAAK,CAACxB,IAAN,CAAWyB,IAAX;AACH;;AACD,YAAI,KAAK,CAAL,KAAWG,cAAc,CAACtF,CAA9B,EAAiC;AAC7BoF,UAAAA,MAAM,GAAG,CAAT;AACH;;AACD,YAAI,KAAK,CAAL,KAAWE,cAAc,CAACK,EAA9B,EAAkC;AAC9BP,UAAAA,MAAM,IAAIQ,UAAU,CAACN,cAAc,CAACK,EAAhB,CAApB;AACH;;AACDR,QAAAA,IAAI,CAACK,QAAL,CAAc9B,IAAd,CAAmBlF,OAAnB;AACA2G,QAAAA,IAAI,CAACtG,OAAL,CAAa6E,IAAb,CAAkB6B,aAAlB;AACAJ,QAAAA,IAAI,CAACO,OAAL,CAAahC,IAAb,CAAkB0B,MAAlB;AACAhC,QAAAA,YAAY,CAACzF,OAAD,EAAU4H,aAAV,CAAZ;AACAJ,QAAAA,IAAI,CAACM,MAAL,CAAY/B,IAAZ,CAAiB/F,OAAO,CAAC0G,WAAR,CAAoBkB,aAAa,CAACxG,IAAlC,EAAwCzC,KAAzD;AACH;AACJ;AACJ;;AACD4I,EAAAA,KAAK,CAACvC,OAAN,CAAc,UAASwC,IAAT,EAAe;AACzB,QAAIU,WAAW,GAAGV,IAAI,CAACM,MAAL,CAAYK,MAAZ,CAAmB,UAASD,WAAT,EAAsBvJ,KAAtB,EAA6B;AAC9D,aAAOuJ,WAAW,GAAGvJ,KAArB;AACH,KAFiB,EAEf,CAFe,CAAlB;AAGA,QAAIyJ,KAAK,GAAG,CAAZ;AACA,QAAIC,aAAa,GAAG,CAApB;;AACA,QAAI,aAAanH,OAAO,CAACK,SAAzB,EAAoC;AAChC6G,MAAAA,KAAK,GAAGF,WAAW,GAAG,CAAtB;AACH;;AACD,QAAI,UAAUhH,OAAO,CAACK,SAAtB,EAAiC;AAC7B6G,MAAAA,KAAK,GAAGF,WAAR;AACH;;AACDV,IAAAA,IAAI,CAACtG,OAAL,CAAa8D,OAAb,CAAqB,UAASsD,CAAT,EAAYC,KAAZ,EAAmB;AACpC,UAAI5J,KAAK,GAAG6I,IAAI,CAACM,MAAL,CAAYS,KAAZ,CAAZ;AACAD,MAAAA,CAAC,CAAClG,CAAF,GAAMkG,CAAC,CAAClG,CAAF,GAAMgG,KAAN,GAAcC,aAApB;AACAC,MAAAA,CAAC,CAACjG,CAAF,IAAOmF,IAAI,CAACO,OAAL,CAAaQ,KAAb,CAAP;AACAF,MAAAA,aAAa,IAAI1J,KAAjB;AACH,KALD;AAMA6I,IAAAA,IAAI,CAACK,QAAL,CAAc7C,OAAd,CAAsB,UAASnE,OAAT,EAAkB0H,KAAlB,EAAyB;AAC3CjB,MAAAA,eAAe,CAACzG,OAAO,CAACuG,UAAT,EAAqBpH,OAArB,EAA8BwH,IAAI,CAACtG,OAAL,CAAaqH,KAAb,CAA9B,EAAmDxF,MAAnD,CAAf;AACH,KAFD;AAGH,GArBD;AAsBH;;AAED,SAAS2E,WAAT,CAAqB7G,OAArB,EAA8Bb,OAA9B,EAAuCwI,aAAvC,EAAsDzF,MAAtD,EAA8D;AAC1D,MAAIsE,OAAO,GAAGxG,OAAO,CAACwG,OAAtB;AACA,MAAIoB,MAAM,GAAG,WAAWpB,OAAX,IAAsB,YAAYA,OAAlC,IAA6C,KAAK,CAAL,KAAWA,OAArE;AACA,MAAIqB,OAAO,GAAG,YAAYrB,OAA1B;AACA,MAAInG,OAAO,GAAG,CAAC,GAAG9E,OAAO,CAAC+E,MAAZ,EAAoB,EAApB,EAAwBqH,aAAxB,EAAuC5H,iBAAiB,CAACC,OAAD,EAAUkC,MAAM,CAACjC,YAAjB,CAAxD,CAAd;;AACA,MAAI,aAAaI,OAAO,CAACyH,UAArB,IAAmCzH,OAAO,CAAC,mBAAD,CAA9C,EAAqE;AACjE;AACH;;AACDlB,EAAAA,OAAO,CAACyC,IAAR;AACA,GAACiG,OAAD,IAAYpF,gBAAgB,CAACtD,OAAD,EAAUkB,OAAV,CAA5B;AACAqC,EAAAA,WAAW,CAACvD,OAAD,EAAUkB,OAAV,EAAmB6B,MAAnB,CAAX;AACAgE,EAAAA,gBAAgB,CAAC7F,OAAD,CAAhB;AACA,MAAI0H,OAAJ;AACA5I,EAAAA,OAAO,CAAC6I,SAAR;;AACA,UAAQhI,OAAO,CAACwG,OAAhB;AACI,SAAK,KAAK,CAAV;AACIjB,MAAAA,QAAQ,CAACpG,OAAD,EAAUkB,OAAV,EAAmB6B,MAAnB,CAAR;AACA;;AACJ,SAAK,MAAL;AACA,SAAK,OAAL;AACIuE,MAAAA,eAAe,CAACzG,OAAO,CAACuG,UAAT,EAAqBpH,OAArB,EAA8BkB,OAA9B,EAAuC6B,MAAvC,CAAf;AACA;;AACJ,SAAK,OAAL;AACI6F,MAAAA,OAAO,GAAG9F,SAAS,CAAC9C,OAAD,EAAUkB,OAAV,EAAmB6B,MAAnB,CAAnB;AACA;;AACJ,SAAK,MAAL;AACIc,MAAAA,QAAQ,CAAC7D,OAAD,EAAUkB,OAAO,CAAC8B,CAAlB,CAAR;AACA;;AACJ,SAAK,MAAL;AACIb,MAAAA,QAAQ,CAACnC,OAAD,EAAUkB,OAAV,CAAR;AACAlB,MAAAA,OAAO,CAAC0E,SAAR;AACA;;AACJ,SAAK,QAAL;AACI1E,MAAAA,OAAO,CAACW,GAAR,CAAYO,OAAO,CAAC4H,EAApB,EAAwB5H,OAAO,CAAC6H,EAAhC,EAAoC7H,OAAO,CAAC8H,CAA5C,EAA+C,CAA/C,EAAkD,IAAI5L,EAAtD,EAA0D,CAA1D;AAnBR;;AAqBA,MAAI,CAACqL,MAAL,EAAa;AACTpC,IAAAA,WAAW,CAACrG,OAAD,EAAUkB,OAAV,EAAmB6B,MAAnB,CAAX;AACA+D,IAAAA,WAAW,CAAC9G,OAAD,EAAUkB,OAAV,EAAmB6B,MAAnB,CAAX;AACAwD,IAAAA,aAAa,CAACvG,OAAD,EAAUkB,OAAV,CAAb;AACH;;AACD+H,EAAAA,aAAa,CAACjJ,OAAD,EAAUkB,OAAV,EAAmB6B,MAAnB,EAA2BlC,OAA3B,CAAb;AACAb,EAAAA,OAAO,CAAC6C,OAAR;AACA,SAAO+F,OAAP;AACH;;AAED,SAASK,aAAT,CAAuBjJ,OAAvB,EAAgCkB,OAAhC,EAAyCgI,IAAzC,EAA+CrI,OAA/C,EAAwD;AACpD,MAAIsI,SAAS,GAAGD,IAAI,CAACC,SAArB;;AACA,MAAI,MAAMA,SAAS,CAAC5J,MAApB,EAA4B;AACxB;AACH;;AACD,MAAI6J,EAAE,GAAG9D,QAAQ,CAACpE,OAAO,CAAC2E,IAAT,CAAjB;;AACA,MAAIuD,EAAE,IAAID,SAAS,CAACC,EAAD,CAAnB,EAAyB;AACrB,QAAIC,GAAG,GAAGxI,OAAO,CAACyI,OAAR,EAAV;AACA,QAAIC,QAAQ,GAAGvJ,OAAO,CAACwJ,oBAAR,CAA6BH,GAAG,CAACjH,CAAjC,EAAoC,CAApC,EAAuCiH,GAAG,CAACjH,CAAJ,GAAQiH,GAAG,CAAC1K,KAAnD,EAA0D,CAA1D,CAAf;AACAwK,IAAAA,SAAS,CAACC,EAAD,CAAT,CAAcpE,OAAd,CAAsB,UAASyE,GAAT,EAAc;AAChC,UAAIhC,MAAM,GAAGb,QAAQ,CAAC6C,GAAG,CAAChC,MAAJ,CAAWnG,OAAX,CAAmB,GAAnB,EAAwB,EAAxB,CAAD,CAArB;AACAiI,MAAAA,QAAQ,CAACG,YAAT,CAAsBjC,MAAM,GAAG,GAA/B,EAAoCgC,GAAG,CAACE,SAAxC;AACH,KAHD;AAIA3J,IAAAA,OAAO,CAACqD,WAAR,GAAsBnC,OAAO,CAACmE,OAA9B;AACArF,IAAAA,OAAO,CAACmG,SAAR,GAAoBoD,QAApB;AACAvJ,IAAAA,OAAO,CAAC6F,IAAR;AACH;AACJ;;AAED,SAASQ,WAAT,CAAqBrG,OAArB,EAA8BkB,OAA9B,EAAuC6B,MAAvC,EAA+C;AAC3C,MAAI6G,aAAJ;AACA,MAAIR,EAAE,GAAG9D,QAAQ,CAACpE,OAAO,CAAC+C,MAAT,CAAjB;;AACA,MAAImF,EAAJ,EAAQ;AACJQ,IAAAA,aAAa,GAAG7G,MAAM,CAAC8G,OAAP,CAAeT,EAAf,CAAhB;;AACA,QAAI,CAACQ,aAAL,EAAoB;AAChBA,MAAAA,aAAa,GAAG;AACZE,QAAAA,OAAO,EAAE,CADG;AAEZC,QAAAA,OAAO,EAAE,CAFG;AAGZC,QAAAA,IAAI,EAAE,CAHM;AAIZC,QAAAA,KAAK,EAAE;AAJK,OAAhB;AAMH;;AACDjK,IAAAA,OAAO,CAACkK,aAAR,GAAwBN,aAAa,CAACE,OAAtC;AACA9J,IAAAA,OAAO,CAACmK,aAAR,GAAwBP,aAAa,CAACG,OAAtC;AACA/J,IAAAA,OAAO,CAACoK,WAAR,GAAsBR,aAAa,CAACK,KAApC;AACAjK,IAAAA,OAAO,CAACqK,UAAR,GAAqBT,aAAa,CAACI,IAAnC;AACH;AACJ;;AAED,SAAS1G,gBAAT,CAA0BtD,OAA1B,EAAmCkB,OAAnC,EAA4C;AACxClB,EAAAA,OAAO,CAAC0C,SAAR,CAAkBxB,OAAO,CAACS,UAAR,IAAsB,CAAxC,EAA2CT,OAAO,CAACU,UAAR,IAAsB,CAAjE;AACAV,EAAAA,OAAO,CAACS,UAAR,GAAqB,KAAK,CAA1B;AACAT,EAAAA,OAAO,CAACU,UAAR,GAAqB,KAAK,CAA1B;;AACA,MAAIV,OAAO,CAACW,aAAZ,EAA2B;AACvB7B,IAAAA,OAAO,CAAC0C,SAAR,CAAkBxB,OAAO,CAACY,SAAR,IAAqB,CAAvC,EAA0CZ,OAAO,CAACa,SAAR,IAAqB,CAA/D;AACA/B,IAAAA,OAAO,CAACsK,MAAR,CAAepJ,OAAO,CAACW,aAAR,GAAwBzE,EAAxB,GAA6B,GAA5C;AACA4C,IAAAA,OAAO,CAAC0C,SAAR,CAAkB,EAAExB,OAAO,CAACY,SAAR,IAAqB,CAAvB,CAAlB,EAA6C,EAAEZ,OAAO,CAACa,SAAR,IAAqB,CAAvB,CAA7C;AACAb,IAAAA,OAAO,CAACW,aAAR,GAAwB,KAAK,CAA7B;AACAX,IAAAA,OAAO,CAACY,SAAR,GAAoB,KAAK,CAAzB;AACAZ,IAAAA,OAAO,CAACa,SAAR,GAAoB,KAAK,CAAzB;AACH;;AACD,MAAIwI,QAAQ,CAACrJ,OAAO,CAACc,MAAT,CAAZ,EAA8B;AAC1BhC,IAAAA,OAAO,CAACwK,KAAR,CAActJ,OAAO,CAACc,MAAtB,EAA8Bd,OAAO,CAACe,MAAtC;AACAf,IAAAA,OAAO,CAACc,MAAR,GAAiB,KAAK,CAAtB;AACAd,IAAAA,OAAO,CAACe,MAAR,GAAiB,KAAK,CAAtB;AACH;AACJ;;AAED,SAASsB,WAAT,CAAqBvD,OAArB,EAA8BkB,OAA9B,EAAuC6B,MAAvC,EAA+C;AAC3C,MAAI7B,OAAO,CAAC,WAAD,CAAX,EAA0B;AACtBwG,IAAAA,WAAW,CAAC3E,MAAM,CAAC0H,SAAP,CAAiBnF,QAAQ,CAACpE,OAAO,CAAC,WAAD,CAAR,CAAzB,CAAD,EAAmDlB,OAAnD,EAA4D,EAA5D,EAAgE+C,MAAhE,CAAX;AACA/C,IAAAA,OAAO,CAAC0K,IAAR;AACAxJ,IAAAA,OAAO,CAAC,WAAD,CAAP,GAAuB,KAAK,CAA5B;AACH;AACJ;;AAED,SAASyJ,QAAT,CAAkBC,QAAlB,EAA4BC,KAA5B,EAAmC;AAC/B,MAAIZ,KAAK,GAAG,IAAIlO,OAAO,CAACiB,OAAZ,CAAoB4N,QAApB,CAAZ;AACA,SAAO,UAAUX,KAAK,CAACjB,CAAhB,GAAoB,GAApB,GAA0BiB,KAAK,CAACa,CAAhC,GAAoC,GAApC,GAA0Cb,KAAK,CAACc,CAAhD,GAAoD,GAApD,GAA0DF,KAA1D,GAAkE,GAAzE;AACH;;AAED,SAASG,cAAT,CAAwBnK,OAAxB,EAAiC;AAC7B,MAAIK,OAAO,GAAG,EAAd;AACA,GAAC,GAAG/E,SAAS,CAAC8O,IAAd,EAAoBpK,OAAO,CAACuG,UAA5B,EAAwC,UAAS8D,CAAT,EAAYC,KAAZ,EAAmB;AACvD,QAAIlK,UAAU,GAAGkK,KAAK,CAAClK,UAAvB;AACAC,IAAAA,OAAO,CAAC6E,IAAR,CAAa;AACT0B,MAAAA,MAAM,EAAExG,UAAU,CAACwG,MAAX,CAAkB2D,KADjB;AAETzB,MAAAA,SAAS,EAAE1I,UAAU,CAAC,YAAD,CAAV,CAAyBmK;AAF3B,KAAb;AAIH,GAND;AAOA,SAAOlK,OAAP;AACH;;AAED,SAASmK,YAAT,CAAsBxK,OAAtB,EAA+B;AAC3B,MAAIoJ,KAAJ;AACA,MAAI5E,OAAJ;AACA,MAAIuE,aAAa,GAAG,EAApB;AACA,GAAC,GAAGzN,SAAS,CAAC8O,IAAd,EAAoBpK,OAAO,CAACuG,UAA5B,EAAwC,UAAS8D,CAAT,EAAYI,IAAZ,EAAkB;AACtD,QAAIvK,IAAI,GAAGuK,IAAI,CAACrK,UAAhB;;AACA,QAAI,CAACF,IAAI,CAACwK,MAAV,EAAkB;AACd;AACH;;AACD,YAAQxK,IAAI,CAACwK,MAAL,CAAYH,KAApB;AACI,WAAK,oBAAL;AACIxB,QAAAA,aAAa,CAACI,IAAd,GAAqB7L,OAAO,CAAC4C,IAAI,CAACyK,YAAL,CAAkBJ,KAAnB,CAA5B;AACA;;AACJ,WAAK,cAAL;AACIxB,QAAAA,aAAa,CAACE,OAAd,GAAwB3L,OAAO,CAAC4C,IAAI,CAAC0K,EAAL,CAAQL,KAAT,CAA/B;AACAxB,QAAAA,aAAa,CAACG,OAAd,GAAwB5L,OAAO,CAAC4C,IAAI,CAACiH,EAAL,CAAQoD,KAAT,CAA/B;AACA;;AACJ,WAAK,aAAL;AACInB,QAAAA,KAAK,GAAGlJ,IAAI,CAAC,aAAD,CAAJ,GAAsBA,IAAI,CAAC,aAAD,CAAJ,CAAoBqK,KAA1C,GAAkD,MAA1D;AACA/F,QAAAA,OAAO,GAAGtE,IAAI,CAAC,eAAD,CAAJ,GAAwBA,IAAI,CAAC,eAAD,CAAJ,CAAsBqK,KAA9C,GAAsD,CAAhE;AACAxB,QAAAA,aAAa,CAACK,KAAd,GAAsBU,QAAQ,CAACV,KAAD,EAAQ5E,OAAR,CAA9B;AAXR;AAaH,GAlBD;AAmBA,SAAOuE,aAAP;AACH;;AAED,SAAS8B,SAAT,CAAmBC,KAAnB,EAA0BC,QAA1B,EAAoC;AAChC,MAAI5I,CAAC,GAAG6I,SAAS,CAACtM,MAAV,GAAmB,CAAnB,IAAwB,KAAK,CAAL,KAAWsM,SAAS,CAAC,CAAD,CAA5C,GAAkDA,SAAS,CAAC,CAAD,CAA3D,GAAiE,IAAIjP,SAAS,CAACqG,QAAd,EAAzE;;AACA,MAAI,MAAM0I,KAAK,CAACpM,MAAhB,EAAwB;AACpB,WAAOyD,CAAC,CAACQ,OAAF,EAAP;AACH;;AACD,MAAI+H,MAAM,GAAGK,QAAQ,CAACD,KAAK,CAAC,CAAD,CAAN,CAArB;;AAEA,WAASG,IAAT,GAAgB;AACZJ,IAAAA,SAAS,CAACK,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BP,KAA3B,EAAkC,CAAlC,CAAD,EAAuCC,QAAvC,EAAiD5I,CAAjD,CAAT;AACH;;AACD,MAAI,CAAC,GAAGhH,KAAK,CAACmQ,SAAV,EAAqBZ,MAArB,CAAJ,EAAkC;AAC9BA,IAAAA,MAAM,CAACa,IAAP,CAAYN,IAAZ;AACH,GAFD,MAEO;AACHA,IAAAA,IAAI;AACP;;AACD,SAAO9I,CAAP;AACH;;AAED,SAASqJ,kBAAT,CAA4BxE,QAA5B,EAAsC7H,OAAtC,EAA+CwI,aAA/C,EAA8DzF,MAA9D,EAAsE;AAClE,SAAO2I,SAAS,CAAC7D,QAAD,EAAW,UAAShH,OAAT,EAAkB;AACzC,YAAQA,OAAO,CAACwG,OAAR,IAAmBxG,OAAO,CAACwG,OAAR,CAAgBiF,WAAhB,EAA3B;AACI,WAAK,GAAL;AACA,WAAK,KAAL;AACI,YAAIpL,OAAO,GAAG,CAAC,GAAG9E,OAAO,CAAC+E,MAAZ,EAAoB,EAApB,EAAwBqH,aAAxB,EAAuC5H,iBAAiB,CAACC,OAAD,EAAUkC,MAAM,CAACjC,YAAjB,CAAxD,CAAd;AACAd,QAAAA,OAAO,CAACyC,IAAR;AACAa,QAAAA,gBAAgB,CAACtD,OAAD,EAAUkB,OAAV,CAAhB;AACAqC,QAAAA,WAAW,CAACvD,OAAD,EAAUkB,OAAV,EAAmB6B,MAAnB,CAAX;;AACA,YAAIwJ,MAAM,GAAG,SAATA,MAAS,GAAW;AACpBvM,UAAAA,OAAO,CAAC6C,OAAR;AACH,SAFD;;AAGA,YAAIG,CAAC,GAAGqJ,kBAAkB,CAACxL,OAAO,CAACuG,UAAT,EAAqBpH,OAArB,EAA8BkB,OAA9B,EAAuC6B,MAAvC,CAA1B;;AACA,YAAI,CAAC,GAAG/G,KAAK,CAACmQ,SAAV,EAAqBnJ,CAArB,CAAJ,EAA6B;AACzBA,UAAAA,CAAC,CAACoJ,IAAF,CAAOG,MAAP;AACH,SAFD,MAEO;AACHA,UAAAA,MAAM;AACT;;AACD,eAAOvJ,CAAP;;AACJ,WAAK,MAAL;AACI,eAAOqJ,kBAAkB,CAACxL,OAAO,CAACuG,UAAT,EAAqBpH,OAArB,EAA8B,EAA9B,EAAkC+C,MAAlC,CAAzB;;AACJ,WAAK,UAAL;AACIA,QAAAA,MAAM,CAAC0H,SAAP,CAAiB5J,OAAO,CAACI,UAAR,CAAmBmI,EAAnB,CAAsB/H,WAAvC,IAAsDR,OAAO,CAACuG,UAAR,CAAmB,CAAnB,CAAtD;AACA;;AACJ,WAAK,SAAL;AACIrE,QAAAA,MAAM,CAACyJ,QAAP,CAAgB3L,OAAO,CAACI,UAAR,CAAmBmI,EAAnB,CAAsB/H,WAAtC,IAAqDR,OAArD;AACA;;AACJ,WAAK,QAAL;AACIkC,QAAAA,MAAM,CAAC8G,OAAP,CAAehJ,OAAO,CAACuI,EAAvB,IAA6BiC,YAAY,CAACxK,OAAD,CAAzC;AACA;;AACJ,WAAK,gBAAL;AACIkC,QAAAA,MAAM,CAACoG,SAAP,CAAiBtI,OAAO,CAACI,UAAR,CAAmBmI,EAAnB,CAAsB/H,WAAvC,IAAsD2J,cAAc,CAACnK,OAAD,CAApE;AACA;;AACJ;AACI,eAAO6G,WAAW,CAAC7G,OAAD,EAAUb,OAAV,EAAmBwI,aAAnB,EAAkCzF,MAAlC,CAAlB;AAhCR;AAkCH,GAnCe,CAAhB;AAoCH;;AAED,SAAS0J,WAAT,CAAqBzM,OAArB,EAA8BkB,OAA9B,EAAuC;AACnC,MAAIsE,OAAO,GAAGtE,OAAO,CAAC,kBAAD,CAAP,IAA+BA,OAAO,CAAC,kBAAD,CAAP,CAA4BQ,KAA5B,CAAkC,QAAlC,CAA7C;;AACA,MAAI8D,OAAO,IAAIA,OAAO,CAACjG,MAAvB,EAA+B;AAC3BiG,IAAAA,OAAO,GAAG,CAAC,GAAGrJ,SAAS,CAACuQ,GAAd,EAAmBlH,OAAnB,EAA4B,UAAStB,IAAT,EAAe;AACjD,aAAO/F,OAAO,CAAC+F,IAAD,CAAd;AACH,KAFS,CAAV;AAGAlE,IAAAA,OAAO,CAACyM,WAAR,CAAoBjH,OAApB;AACH;AACJ;;AAED,SAASe,aAAT,CAAuBvG,OAAvB,EAAgCkB,OAAhC,EAAyCuH,MAAzC,EAAiD;AAC7C,MAAIkE,MAAM,GAAGzL,OAAO,CAACyL,MAArB;;AACA,MAAIA,MAAM,IAAI,WAAWA,MAArB,IAA+B,MAAMzL,OAAO,CAAC,cAAD,CAAhD,EAAkE;AAC9DuL,IAAAA,WAAW,CAACzM,OAAD,EAAUkB,OAAV,CAAX;AACAlB,IAAAA,OAAO,CAAC4M,QAAR,GAAmB1L,OAAO,CAAC,iBAAD,CAA1B;AACAlB,IAAAA,OAAO,CAAC6M,SAAR,GAAoB3L,OAAO,CAAC,cAAD,CAA3B;AACAlB,IAAAA,OAAO,CAACqD,WAAR,GAAsBnC,OAAO,CAAC8F,aAA9B;AACAhH,IAAAA,OAAO,CAAC8M,WAAR,GAAsBH,MAAtB;AACAlE,IAAAA,MAAM,GAAGzI,OAAO,CAAC+M,UAAR,CAAmB7L,OAAO,CAACE,IAA3B,EAAiCF,OAAO,CAACkB,CAAzC,EAA4ClB,OAAO,CAACmB,CAApD,CAAH,GAA4DrC,OAAO,CAAC2M,MAAR,EAAlE;AACA3M,IAAAA,OAAO,CAACqD,WAAR,GAAsB,CAAtB;AACH;AACJ;;AAED,SAAS2J,UAAT,CAAoBhN,OAApB,EAA6BiN,OAA7B,EAAsClK,MAAtC,EAA8C;AAC1C,MAAI7B,OAAO,GAAGN,iBAAiB,CAACqM,OAAD,EAAUlK,MAAM,CAACjC,YAAjB,CAA/B;AACA,MAAIoM,aAAa,GAAGxO,YAAY,CAACwC,OAAO,CAACvC,KAAT,EAAgBuC,OAAO,CAACtC,MAAxB,EAAgC,CAAhC,CAAhC;AACA,MAAIuO,cAAc,GAAGD,aAAa,CAACE,UAAd,CAAyB,IAAzB,CAArB;AACAf,EAAAA,kBAAkB,CAACY,OAAO,CAAC7F,UAAT,EAAqB+F,cAArB,EAAqCjM,OAArC,EAA8C6B,MAA9C,CAAlB;AACA,SAAO/C,OAAO,CAACqN,aAAR,CAAsBH,aAAtB,EAAqC,QAArC,CAAP;AACH;;AAED,SAASpG,WAAT,CAAqB9G,OAArB,EAA8BkB,OAA9B,EAAuC6B,MAAvC,EAA+C;AAC3C,MAAI8C,IAAI,GAAG3E,OAAO,CAAC2E,IAAnB;;AACA,MAAIA,IAAI,IAAI,WAAWA,IAAvB,EAA6B;AACzB,QAAIA,IAAI,CAACyH,MAAL,CAAY,KAAZ,MAAuB,CAAC,CAA5B,EAA+B;AAC3BtN,MAAAA,OAAO,CAACmG,SAAR,GAAoBN,IAApB;AACH,KAFD,MAEO;AACH,UAAIoH,OAAO,GAAGlK,MAAM,CAACyJ,QAAP,CAAgBlH,QAAQ,CAACO,IAAD,CAAxB,CAAd;;AACA,UAAI,CAACoH,OAAL,EAAc;AACV;AACH;;AACDjN,MAAAA,OAAO,CAACmG,SAAR,GAAoB6G,UAAU,CAAChN,OAAD,EAAUiN,OAAV,EAAmBlK,MAAnB,CAA9B;AACH;;AACD/C,IAAAA,OAAO,CAACqD,WAAR,GAAsBnC,OAAO,CAAC+F,WAA9B;AACAjH,IAAAA,OAAO,CAAC6F,IAAR;AACA7F,IAAAA,OAAO,CAACqD,WAAR,GAAsB,CAAtB;AACH;AACJ;;AACD,IAAIrC,eAAe,GAAG,yBAASC,UAAT,EAAqB;AACvC,MAAIsM,aAAa,GAAG,EAApB;AACA,MAAIxM,IAAJ;AACA,GAAC,GAAG5E,SAAS,CAAC8O,IAAd,EAAoBhK,UAApB,EAAgC,UAASsH,KAAT,EAAgBrE,IAAhB,EAAsB;AAClDnD,IAAAA,IAAI,GAAGmD,IAAI,CAAC7C,WAAZ;;AACA,QAAIkJ,QAAQ,CAACxJ,IAAD,CAAZ,EAAoB;AAChBA,MAAAA,IAAI,GAAG5C,OAAO,CAAC4C,IAAD,CAAd;AACH;;AACDwM,IAAAA,aAAa,CAACrJ,IAAI,CAACsJ,IAAL,CAAUlB,WAAV,EAAD,CAAb,GAAyCvL,IAAzC;AACH,GAND;AAOA,SAAOwM,aAAP;AACH,CAXD;;AAaA,SAASE,cAAT,CAAwBzN,OAAxB,EAAiCrB,KAAjC,EAAwCC,MAAxC,EAAgD8O,eAAhD,EAAiE7O,MAAjE,EAAyE;AACrEmB,EAAAA,OAAO,CAACmG,SAAR,GAAoBuH,eAAe,IAAI,SAAvC;AACA1N,EAAAA,OAAO,CAAC2N,QAAR,CAAiB,CAAC9O,MAAlB,EAA0B,CAACA,MAA3B,EAAmCF,KAAK,GAAG,IAAIE,MAA/C,EAAuDD,MAAM,GAAG,IAAIC,MAApE;AACH;;AAED,SAAS+O,kBAAT,GAA8B;AAC1B,MAAIC,YAAY,GAAGvR,aAAa,CAACU,OAAd,CAAsB8Q,aAAtB,CAAoC,KAApC,CAAnB;;AACAD,EAAAA,YAAY,CAAClJ,KAAb,CAAmBoJ,IAAnB,GAA0B,SAA1B;AACAF,EAAAA,YAAY,CAAClJ,KAAb,CAAmBqJ,QAAnB,GAA8B,UAA9B;AACA,SAAOH,YAAP;AACH;;AAED,SAASI,kBAAT,CAA4BC,GAA5B,EAAiCpP,MAAjC,EAAyCgC,YAAzC,EAAuD;AACnD,SAAOuL,kBAAkB,CAAC6B,GAAG,CAAC9G,UAAL,EAAiBtI,MAAM,CAACsO,UAAP,CAAkB,IAAlB,CAAjB,EAA0C,EAA1C,EAA8C;AACnE3C,IAAAA,SAAS,EAAE,EADwD;AAEnE+B,IAAAA,QAAQ,EAAE,EAFyD;AAGnE3C,IAAAA,OAAO,EAAE,EAH0D;AAInEV,IAAAA,SAAS,EAAE,EAJwD;AAKnErI,IAAAA,YAAY,EAAEA;AALqD,GAA9C,CAAzB;AAOH;;AAED,SAASqN,gBAAT,CAA0BC,MAA1B,EAAkCzP,KAAlC,EAAyCC,MAAzC,EAAiD8O,eAAjD,EAAkE7O,MAAlE,EAA0E;AACtE,MAAIwP,WAAW,GAAGxC,SAAS,CAACtM,MAAV,GAAmB,CAAnB,IAAwB,KAAK,CAAL,KAAWsM,SAAS,CAAC,CAAD,CAA5C,GAAkDA,SAAS,CAAC,CAAD,CAA3D,GAAiEoC,kBAAnF;AACA,MAAInP,MAAM,GAAGJ,YAAY,CAACC,KAAD,EAAQC,MAAR,EAAgBC,MAAhB,CAAzB;AACA,MAAImB,OAAO,GAAGlB,MAAM,CAACsO,UAAP,CAAkB,IAAlB,CAAd;;AACA,MAAIkB,OAAO,GAAGpS,KAAK,CAACc,OAAN,CAAcuR,aAAd,CAA4BH,MAA5B,CAAd;;AACA,MAAIP,YAAJ;;AACA,MAAIW,kBAAkB,GAAGlS,aAAa,CAACU,OAAd,CAAsB8H,aAAtB,CAAoCsJ,MAApC,CAAzB;;AACApO,EAAAA,OAAO,CAAC0C,SAAR,CAAkB7D,MAAlB,EAA0BA,MAA1B;;AACAvC,EAAAA,aAAa,CAACU,OAAd,CAAsByR,OAAtB,GAAgCC,WAAhC,CAA4C5P,MAA5C;;AACA,MAAI,CAAC0P,kBAAL,EAAyB;AACrBX,IAAAA,YAAY,GAAGD,kBAAkB,EAAjC;AACAC,IAAAA,YAAY,CAACa,WAAb,CAAyBJ,OAAzB;;AACAhS,IAAAA,aAAa,CAACU,OAAd,CAAsByR,OAAtB,GAAgCC,WAAhC,CAA4Cb,YAA5C;AACH;;AACD,MAAIS,OAAO,CAACrN,UAAR,CAAmB0N,SAAvB,EAAkC;AAC9B7P,IAAAA,MAAM,CAAC8P,GAAP,GAAaN,OAAO,CAACrN,UAAR,CAAmB0N,SAAnB,CAA6BtN,WAA1C;AACH;;AACDoM,EAAAA,cAAc,CAACzN,OAAD,EAAUrB,KAAV,EAAiBC,MAAjB,EAAyB8O,eAAzB,EAA0C7O,MAA1C,CAAd;AACA,SAAO,CAAC,GAAGjC,SAAS,CAACiS,WAAd,EAA2BR,WAAW,CAACC,OAAD,EAAUxP,MAAV,EAAkB0P,kBAAkB,IAAIhS,KAAK,CAACQ,OAAN,CAAc8R,QAAd,CAAuBxS,aAAa,CAACU,OAAd,CAAsByR,OAAtB,EAAvB,EAAwDL,MAAxD,CAAxC,CAAtC,EAAgJhC,IAAhJ,CAAqJ,YAAW;AACnK,WAAOtN,MAAP;AACH,GAFM,EAEJiQ,MAFI,CAEG,YAAW;AACjBlB,IAAAA,YAAY,IAAIvR,aAAa,CAACU,OAAd,CAAsByR,OAAtB,GAAgCO,WAAhC,CAA4CnB,YAA5C,CAAhB;;AACAvR,IAAAA,aAAa,CAACU,OAAd,CAAsByR,OAAtB,GAAgCO,WAAhC,CAA4ClQ,MAA5C;AACH,GALM,CAAP;AAMH;;AACDmQ,OAAO,CAACC,YAAR,GAAuB;AACnBC,EAAAA,YAAY,EAAE,sBAASf,MAAT,EAAiBlN,OAAjB,EAA0B;AACpC,QAAIjC,QAAQ,GAAG,WAAWiC,OAAO,CAACkO,MAAlC;AACA,QAAIzQ,KAAK,GAAGuC,OAAO,CAACvC,KAApB;AACA,QAAIC,MAAM,GAAGsC,OAAO,CAACtC,MAArB;AACA,QAAI8O,eAAe,GAAGxM,OAAO,CAACwM,eAA9B;;AACA,QAAI,CAAC,GAAG1R,KAAK,CAACqT,UAAV,EAAsBnO,OAAO,CAACoO,mBAA9B,CAAJ,EAAwD;AACpDtO,MAAAA,eAAe,GAAGE,OAAO,CAACoO,mBAA1B;AACH;;AACD,WAAOnB,gBAAgB,CAACC,MAAD,EAASzP,KAAT,EAAgBC,MAAhB,EAAwB8O,eAAxB,EAAyCxM,OAAO,CAACrC,MAAjD,EAAyDqC,OAAO,CAACmN,WAAjE,CAAhB,CAA8FjC,IAA9F,CAAmG,UAAStN,MAAT,EAAiB;AACvH,aAAOE,mBAAmB,CAACF,MAAD,EAASG,QAAT,CAA1B;AACH,KAFM,CAAP;AAGH,GAZkB;AAanBsQ,EAAAA,OAAO,EAAE,iBAASnB,MAAT,EAAiBlN,OAAjB,EAA0B;AAC/B,QAAIsO,IAAI,GAAG,IAAX;AACA,WAAOP,OAAO,CAACC,YAAR,CAAqBC,YAArB,CAAkCf,MAAlC,EAA0ClN,OAA1C,EAAmDkL,IAAnD,CAAwD,UAASqD,UAAT,EAAqB;AAChF,UAAIxQ,QAAQ,GAAG,WAAWiC,OAAO,CAACkO,MAAlC;AACA,UAAIM,IAAI,GAAG,CAAC,GAAG1T,KAAK,CAACqT,UAAV,EAAsBtS,MAAM,CAAC4S,IAA7B,KAAsC,CAACzO,OAAO,CAAC0O,UAA/C,GAA4DJ,IAAI,CAACK,QAAL,CAAcJ,UAAd,EAA0BxQ,QAA1B,CAA5D,GAAkGuQ,IAAI,CAACM,UAAL,CAAgBL,UAAhB,CAA7G;AACA,aAAOC,IAAP;AACH,KAJM,CAAP;AAKH,GApBkB;AAqBnBG,EAAAA,QAAQ,EAAE,kBAASJ,UAAT,EAAqBxQ,QAArB,EAA+B;AACrC,QAAImF,CAAJ;AACA,QAAI2L,SAAS,GAAG,IAAIC,UAAJ,CAAeP,UAAU,CAAClQ,MAA1B,CAAhB;;AACA,SAAK6E,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGqL,UAAU,CAAClQ,MAA3B,EAAmC6E,CAAC,EAApC,EAAwC;AACpC2L,MAAAA,SAAS,CAAC3L,CAAD,CAAT,GAAeqL,UAAU,CAACQ,UAAX,CAAsB7L,CAAtB,CAAf;AACH;;AACD,WAAO,IAAIrH,MAAM,CAAC4S,IAAX,CAAgB,CAACI,SAAS,CAACG,MAAX,CAAhB,EAAoC;AACvCC,MAAAA,IAAI,EAAElR;AADiC,KAApC,CAAP;AAGH,GA9BkB;AA+BnB6Q,EAAAA,UAAU,EAAE,oBAASL,UAAT,EAAqB;AAC7B,WAAO1S,MAAM,CAACqT,IAAP,CAAYX,UAAZ,CAAP;AACH;AAjCkB,CAAvB;;AAmCAR,OAAO,CAACM,OAAR,GAAkB,UAASG,IAAT,EAAexO,OAAf,EAAwB;AACtC,SAAO+N,OAAO,CAACC,YAAR,CAAqBK,OAArB,CAA6BG,IAA7B,EAAmCxO,OAAnC,CAAP;AACH,CAFD;;AAGA+N,OAAO,CAACoB,WAAR,GAAsB,UAASC,OAAT,EAAkB;AACpC,MAAIxR,MAAM,GAAGJ,YAAY,CAAC,GAAD,EAAM,GAAN,EAAW,CAAX,CAAzB;AACA,SAAO4R,OAAO,CAACnI,MAAR,CAAe,UAASa,CAAT,EAAYuH,CAAZ,EAAe;AACjC,QAAItR,QAAQ,GAAG,CAAC,WAAWsR,CAAZ,EAAejE,WAAf,EAAf;;AACA,QAAIxN,MAAM,CAACK,SAAP,CAAiBF,QAAjB,EAA2BuR,OAA3B,CAAmCvR,QAAnC,MAAiD,CAAC,CAAtD,EAAyD;AACrD+J,MAAAA,CAAC,CAACyH,SAAF,CAAY1K,IAAZ,CAAiBwK,CAAjB;AACH,KAFD,MAEO;AACHvH,MAAAA,CAAC,CAAC0H,WAAF,CAAc3K,IAAd,CAAmBwK,CAAnB;AACH;;AACD,WAAOvH,CAAP;AACH,GARM,EAQJ;AACCyH,IAAAA,SAAS,EAAE,EADZ;AAECC,IAAAA,WAAW,EAAE;AAFd,GARI,CAAP;AAYH,CAdD","sourcesContent":["/**\r\n * DevExtreme (exporter/image_creator.js)\r\n * Version: 19.2.7\r\n * Build date: Thu Mar 26 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nvar _renderer = require(\"../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _color = require(\"../color\");\r\nvar _color2 = _interopRequireDefault(_color);\r\nvar _type = require(\"../core/utils/type\");\r\nvar _svg = require(\"../core/utils/svg\");\r\nvar _svg2 = _interopRequireDefault(_svg);\r\nvar _iterator = require(\"../core/utils/iterator\");\r\nvar _extend = require(\"../core/utils/extend\");\r\nvar _dom_adapter = require(\"../core/dom_adapter\");\r\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\r\nvar _dom = require(\"../core/utils/dom\");\r\nvar _dom2 = _interopRequireDefault(_dom);\r\nvar _window = require(\"../core/utils/window\");\r\nvar _window2 = _interopRequireDefault(_window);\r\nvar _inflector = require(\"../core/utils/inflector\");\r\nvar _deferred = require(\"../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar window = _window2.default.getWindow();\r\nvar _math = Math;\r\nvar PI = _math.PI;\r\nvar _min = _math.min;\r\nvar _abs = _math.abs;\r\nvar _sqrt = _math.sqrt;\r\nvar _pow = _math.pow;\r\nvar _atan2 = _math.atan2;\r\nvar _cos = _math.cos;\r\nvar _sin = _math.sin;\r\nvar _number = Number;\r\nvar IMAGE_QUALITY = 1;\r\nvar TEXT_DECORATION_LINE_WIDTH_COEFF = .05;\r\nvar DEFAULT_FONT_SIZE = \"10px\";\r\nvar DEFAULT_FONT_FAMILY = \"sans-serif\";\r\nvar DEFAULT_TEXT_COLOR = \"#000\";\r\n\r\nfunction createCanvas(width, height, margin) {\r\n    var canvas = (0, _renderer2.default)(\"<canvas>\")[0];\r\n    canvas.width = width + 2 * margin;\r\n    canvas.height = height + 2 * margin;\r\n    canvas.hidden = true;\r\n    return canvas\r\n}\r\n\r\nfunction getStringFromCanvas(canvas, mimeType) {\r\n    var dataURL = canvas.toDataURL(mimeType, IMAGE_QUALITY);\r\n    var imageData = window.atob(dataURL.substring((\"data:\" + mimeType + \";base64,\").length));\r\n    return imageData\r\n}\r\n\r\nfunction arcTo(x1, y1, x2, y2, radius, largeArcFlag, clockwise, context) {\r\n    var cBx = (x1 + x2) / 2;\r\n    var cBy = (y1 + y2) / 2;\r\n    var aB = _atan2(y1 - y2, x1 - x2);\r\n    var k = largeArcFlag ? 1 : -1;\r\n    var opSide;\r\n    var adjSide;\r\n    var centerX;\r\n    var centerY;\r\n    var startAngle;\r\n    var endAngle;\r\n    aB += 90 * (PI / 180) * (clockwise ? 1 : -1);\r\n    opSide = _sqrt(_pow(x2 - x1, 2) + _pow(y2 - y1, 2)) / 2;\r\n    adjSide = _sqrt(_abs(_pow(radius, 2) - _pow(opSide, 2)));\r\n    centerX = cBx + k * (adjSide * _cos(aB));\r\n    centerY = cBy + k * (adjSide * _sin(aB));\r\n    startAngle = _atan2(y1 - centerY, x1 - centerX);\r\n    endAngle = _atan2(y2 - centerY, x2 - centerX);\r\n    context.arc(centerX, centerY, radius, startAngle, endAngle, !clockwise)\r\n}\r\n\r\nfunction getElementOptions(element, rootAppended) {\r\n    var attr = parseAttributes(element.attributes || {});\r\n    var options = (0, _extend.extend)({}, attr, {\r\n        text: element.textContent.replace(/\\s+/g, \" \"),\r\n        textAlign: \"middle\" === attr[\"text-anchor\"] ? \"center\" : attr[\"text-anchor\"]\r\n    });\r\n    var transform = attr.transform;\r\n    var coords;\r\n    if (transform) {\r\n        coords = transform.match(/translate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\r\n        if (coords) {\r\n            coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\r\n            options.translateX = _number(coords[0]);\r\n            options.translateY = coords[1] ? _number(coords[1]) : 0\r\n        }\r\n        coords = transform.match(/rotate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*,*\\s*-*\\d+([.]\\d+)*)*/);\r\n        if (coords) {\r\n            coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\r\n            options.rotationAngle = _number(coords[0]);\r\n            options.rotationX = coords[1] && _number(coords[1]);\r\n            options.rotationY = coords[2] && _number(coords[2])\r\n        }\r\n        coords = transform.match(/scale\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\r\n        if (coords) {\r\n            coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\r\n            options.scaleX = _number(coords[0]);\r\n            if (coords.length > 1) {\r\n                options.scaleY = _number(coords[1])\r\n            } else {\r\n                options.scaleY = options.scaleX\r\n            }\r\n        }\r\n    }\r\n    parseStyles(element, options, rootAppended);\r\n    return options\r\n}\r\n\r\nfunction drawRect(context, options) {\r\n    var x = options.x;\r\n    var y = options.y;\r\n    var width = options.width;\r\n    var height = options.height;\r\n    var cornerRadius = options.rx;\r\n    if (!cornerRadius) {\r\n        context.rect(x, y, width, height)\r\n    } else {\r\n        cornerRadius = _min(cornerRadius, width / 2, height / 2);\r\n        context.save();\r\n        context.translate(x, y);\r\n        context.moveTo(width / 2, 0);\r\n        context.arcTo(width, 0, width, height, cornerRadius);\r\n        context.arcTo(width, height, 0, height, cornerRadius);\r\n        context.arcTo(0, height, 0, 0, cornerRadius);\r\n        context.arcTo(0, 0, cornerRadius, 0, cornerRadius);\r\n        context.lineTo(width / 2, 0);\r\n        context.restore()\r\n    }\r\n}\r\n\r\nfunction drawImage(context, options, shared) {\r\n    var d = new _deferred.Deferred;\r\n    var image = new window.Image;\r\n    image.onload = function() {\r\n        context.save();\r\n        context.globalAlpha = options.globalAlpha;\r\n        transformElement(context, options);\r\n        clipElement(context, options, shared);\r\n        context.drawImage(image, options.x, options.y, options.width, options.height);\r\n        context.restore();\r\n        d.resolve()\r\n    };\r\n    image.onerror = function() {\r\n        d.resolve()\r\n    };\r\n    image.setAttribute(\"crossOrigin\", \"anonymous\");\r\n    image.src = options.href || options[\"xlink:href\"];\r\n    return d\r\n}\r\n\r\nfunction drawPath(context, dAttr) {\r\n    var dArray = dAttr.replace(/,/g, \" \").split(/([A-Z])/i).filter(function(item) {\r\n        return \"\" !== item.trim()\r\n    });\r\n    var i = 0;\r\n    var params;\r\n    var prevParams;\r\n    var prevParamsLen;\r\n    do {\r\n        params = (dArray[i + 1] || \"\").trim().split(\" \");\r\n        switch (dArray[i]) {\r\n            case \"M\":\r\n                context.moveTo(_number(params[0]), _number(params[1]));\r\n                i += 2;\r\n                break;\r\n            case \"L\":\r\n                for (var j = 0; j < params.length / 2; j++) {\r\n                    context.lineTo(_number(params[2 * j]), _number(params[2 * j + 1]))\r\n                }\r\n                i += 2;\r\n                break;\r\n            case \"C\":\r\n                context.bezierCurveTo(_number(params[0]), _number(params[1]), _number(params[2]), _number(params[3]), _number(params[4]), _number(params[5]));\r\n                i += 2;\r\n                break;\r\n            case \"a\":\r\n                prevParams = dArray[i - 1].trim().split(\" \");\r\n                prevParamsLen = prevParams.length - 1;\r\n                arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(prevParams[prevParamsLen - 1]) + _number(params[5]), _number(prevParams[prevParamsLen]) + _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\r\n                i += 2;\r\n                break;\r\n            case \"A\":\r\n                prevParams = dArray[i - 1].trim().split(\" \");\r\n                prevParamsLen = prevParams.length - 1;\r\n                arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(params[5]), _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\r\n                i += 2;\r\n                break;\r\n            case \"Z\":\r\n                context.closePath();\r\n                i += 1;\r\n                break;\r\n            default:\r\n                i++\r\n        }\r\n    } while (i < dArray.length)\r\n}\r\n\r\nfunction parseStyles(element, options, rootAppended) {\r\n    var style = element.style || {};\r\n    var field;\r\n    for (field in style) {\r\n        if (\"\" !== style[field]) {\r\n            options[(0, _inflector.camelize)(field)] = style[field]\r\n        }\r\n    }\r\n    if (rootAppended && _dom_adapter2.default.isElementNode(element)) {\r\n        style = window.getComputedStyle(element);\r\n        [\"fill\", \"stroke\", \"stroke-width\", \"font-family\", \"font-size\", \"font-style\", \"font-weight\"].forEach(function(prop) {\r\n            if (prop in style && \"\" !== style[prop]) {\r\n                options[(0, _inflector.camelize)(prop)] = style[prop]\r\n            }\r\n        });\r\n        [\"opacity\", \"fill-opacity\", \"stroke-opacity\"].forEach(function(prop) {\r\n            if (prop in style && \"\" !== style[prop] && \"1\" !== style[prop]) {\r\n                options[prop] = _number(style[prop])\r\n            }\r\n        })\r\n    }\r\n    options.textDecoration = options.textDecoration || options.textDecorationLine;\r\n    options.globalAlpha = (0, _type.isDefined)(options.opacity) ? options.opacity : options.globalAlpha\r\n}\r\n\r\nfunction parseUrl(urlString) {\r\n    var matches = urlString && urlString.match(/url\\(.*#(.*?)[\"']?\\)/i);\r\n    return matches && matches[1]\r\n}\r\n\r\nfunction setFontStyle(context, options) {\r\n    var fontParams = [];\r\n    options.fontSize = options.fontSize || DEFAULT_FONT_SIZE;\r\n    options.fontFamily || DEFAULT_FONT_FAMILY;\r\n    options.fill = options.fill || DEFAULT_TEXT_COLOR;\r\n    options.fontStyle && fontParams.push(options.fontStyle);\r\n    options.fontWeight && fontParams.push(options.fontWeight);\r\n    fontParams.push(options.fontSize);\r\n    fontParams.push(options.fontFamily);\r\n    context.font = fontParams.join(\" \");\r\n    context.textAlign = options.textAlign;\r\n    context.fillStyle = options.fill;\r\n    context.globalAlpha = options.globalAlpha\r\n}\r\n\r\nfunction drawText(context, options, shared) {\r\n    setFontStyle(context, options);\r\n    applyFilter(context, options, shared);\r\n    options.text && context.fillText(options.text, options.x || 0, options.y || 0);\r\n    strokeElement(context, options, true);\r\n    drawTextDecoration(context, options, shared)\r\n}\r\n\r\nfunction drawTextDecoration(context, options, shared) {\r\n    if (!options.textDecoration || \"none\" === options.textDecoration) {\r\n        return\r\n    }\r\n    var x = options.x;\r\n    var textWidth = context.measureText(options.text).width;\r\n    var textHeight = parseInt(options.fontSize, 10);\r\n    var lineHeight = textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF < 1 ? 1 : textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF;\r\n    var y = options.y;\r\n    switch (options.textDecoration) {\r\n        case \"line-through\":\r\n            y -= textHeight / 3 + lineHeight / 2;\r\n            break;\r\n        case \"overline\":\r\n            y -= textHeight - lineHeight;\r\n            break;\r\n        case \"underline\":\r\n            y += lineHeight\r\n    }\r\n    context.rect(x, y, textWidth, lineHeight);\r\n    fillElement(context, options, shared);\r\n    strokeElement(context, options)\r\n}\r\n\r\nfunction aggregateOpacity(options) {\r\n    options.strokeOpacity = void 0 !== options[\"stroke-opacity\"] ? options[\"stroke-opacity\"] : 1;\r\n    options.fillOpacity = void 0 !== options[\"fill-opacity\"] ? options[\"fill-opacity\"] : 1;\r\n    if (void 0 !== options.opacity) {\r\n        options.strokeOpacity *= options.opacity;\r\n        options.fillOpacity *= options.opacity\r\n    }\r\n}\r\n\r\nfunction hasTspan(element) {\r\n    var nodes = element.childNodes;\r\n    for (var i = 0; i < nodes.length; i++) {\r\n        if (\"tspan\" === nodes[i].tagName) {\r\n            return true\r\n        }\r\n    }\r\n    return false\r\n}\r\n\r\nfunction drawTextElement(childNodes, context, options, shared) {\r\n    var lines = [];\r\n    var line;\r\n    var offset = 0;\r\n    for (var i = 0; i < childNodes.length; i++) {\r\n        var element = childNodes[i];\r\n        if (void 0 === element.tagName) {\r\n            drawElement(element, context, options, shared)\r\n        } else {\r\n            if (\"tspan\" === element.tagName || \"text\" === element.tagName) {\r\n                var elementOptions = getElementOptions(element, shared.rootAppended);\r\n                var mergedOptions = (0, _extend.extend)({}, options, elementOptions);\r\n                if (\"tspan\" === element.tagName && hasTspan(element)) {\r\n                    drawTextElement(element.childNodes, context, mergedOptions, shared);\r\n                    continue\r\n                }\r\n                mergedOptions.textAlign = \"start\";\r\n                if (!line || void 0 !== elementOptions.x) {\r\n                    line = {\r\n                        elements: [],\r\n                        options: [],\r\n                        widths: [],\r\n                        offsets: []\r\n                    };\r\n                    lines.push(line)\r\n                }\r\n                if (void 0 !== elementOptions.y) {\r\n                    offset = 0\r\n                }\r\n                if (void 0 !== elementOptions.dy) {\r\n                    offset += parseFloat(elementOptions.dy)\r\n                }\r\n                line.elements.push(element);\r\n                line.options.push(mergedOptions);\r\n                line.offsets.push(offset);\r\n                setFontStyle(context, mergedOptions);\r\n                line.widths.push(context.measureText(mergedOptions.text).width)\r\n            }\r\n        }\r\n    }\r\n    lines.forEach(function(line) {\r\n        var commonWidth = line.widths.reduce(function(commonWidth, width) {\r\n            return commonWidth + width\r\n        }, 0);\r\n        var xDiff = 0;\r\n        var currentOffset = 0;\r\n        if (\"center\" === options.textAlign) {\r\n            xDiff = commonWidth / 2\r\n        }\r\n        if (\"end\" === options.textAlign) {\r\n            xDiff = commonWidth\r\n        }\r\n        line.options.forEach(function(o, index) {\r\n            var width = line.widths[index];\r\n            o.x = o.x - xDiff + currentOffset;\r\n            o.y += line.offsets[index];\r\n            currentOffset += width\r\n        });\r\n        line.elements.forEach(function(element, index) {\r\n            drawTextElement(element.childNodes, context, line.options[index], shared)\r\n        })\r\n    })\r\n}\r\n\r\nfunction drawElement(element, context, parentOptions, shared) {\r\n    var tagName = element.tagName;\r\n    var isText = \"text\" === tagName || \"tspan\" === tagName || void 0 === tagName;\r\n    var isImage = \"image\" === tagName;\r\n    var options = (0, _extend.extend)({}, parentOptions, getElementOptions(element, shared.rootAppended));\r\n    if (\"hidden\" === options.visibility || options[\"hidden-for-export\"]) {\r\n        return\r\n    }\r\n    context.save();\r\n    !isImage && transformElement(context, options);\r\n    clipElement(context, options, shared);\r\n    aggregateOpacity(options);\r\n    var promise;\r\n    context.beginPath();\r\n    switch (element.tagName) {\r\n        case void 0:\r\n            drawText(context, options, shared);\r\n            break;\r\n        case \"text\":\r\n        case \"tspan\":\r\n            drawTextElement(element.childNodes, context, options, shared);\r\n            break;\r\n        case \"image\":\r\n            promise = drawImage(context, options, shared);\r\n            break;\r\n        case \"path\":\r\n            drawPath(context, options.d);\r\n            break;\r\n        case \"rect\":\r\n            drawRect(context, options);\r\n            context.closePath();\r\n            break;\r\n        case \"circle\":\r\n            context.arc(options.cx, options.cy, options.r, 0, 2 * PI, 1)\r\n    }\r\n    if (!isText) {\r\n        applyFilter(context, options, shared);\r\n        fillElement(context, options, shared);\r\n        strokeElement(context, options)\r\n    }\r\n    applyGradient(context, options, shared, element);\r\n    context.restore();\r\n    return promise\r\n}\r\n\r\nfunction applyGradient(context, options, _ref, element) {\r\n    var gradients = _ref.gradients;\r\n    if (0 === gradients.length) {\r\n        return\r\n    }\r\n    var id = parseUrl(options.fill);\r\n    if (id && gradients[id]) {\r\n        var box = element.getBBox();\r\n        var gradient = context.createLinearGradient(box.x, 0, box.x + box.width, 0);\r\n        gradients[id].forEach(function(opt) {\r\n            var offset = parseInt(opt.offset.replace(/%/, \"\"));\r\n            gradient.addColorStop(offset / 100, opt.stopColor)\r\n        });\r\n        context.globalAlpha = options.opacity;\r\n        context.fillStyle = gradient;\r\n        context.fill()\r\n    }\r\n}\r\n\r\nfunction applyFilter(context, options, shared) {\r\n    var filterOptions;\r\n    var id = parseUrl(options.filter);\r\n    if (id) {\r\n        filterOptions = shared.filters[id];\r\n        if (!filterOptions) {\r\n            filterOptions = {\r\n                offsetX: 0,\r\n                offsetY: 0,\r\n                blur: 0,\r\n                color: \"#000\"\r\n            }\r\n        }\r\n        context.shadowOffsetX = filterOptions.offsetX;\r\n        context.shadowOffsetY = filterOptions.offsetY;\r\n        context.shadowColor = filterOptions.color;\r\n        context.shadowBlur = filterOptions.blur\r\n    }\r\n}\r\n\r\nfunction transformElement(context, options) {\r\n    context.translate(options.translateX || 0, options.translateY || 0);\r\n    options.translateX = void 0;\r\n    options.translateY = void 0;\r\n    if (options.rotationAngle) {\r\n        context.translate(options.rotationX || 0, options.rotationY || 0);\r\n        context.rotate(options.rotationAngle * PI / 180);\r\n        context.translate(-(options.rotationX || 0), -(options.rotationY || 0));\r\n        options.rotationAngle = void 0;\r\n        options.rotationX = void 0;\r\n        options.rotationY = void 0\r\n    }\r\n    if (isFinite(options.scaleX)) {\r\n        context.scale(options.scaleX, options.scaleY);\r\n        options.scaleX = void 0;\r\n        options.scaleY = void 0\r\n    }\r\n}\r\n\r\nfunction clipElement(context, options, shared) {\r\n    if (options[\"clip-path\"]) {\r\n        drawElement(shared.clipPaths[parseUrl(options[\"clip-path\"])], context, {}, shared);\r\n        context.clip();\r\n        options[\"clip-path\"] = void 0\r\n    }\r\n}\r\n\r\nfunction hex2rgba(hexColor, alpha) {\r\n    var color = new _color2.default(hexColor);\r\n    return \"rgba(\" + color.r + \",\" + color.g + \",\" + color.b + \",\" + alpha + \")\"\r\n}\r\n\r\nfunction createGradient(element) {\r\n    var options = [];\r\n    (0, _iterator.each)(element.childNodes, function(_, _ref2) {\r\n        var attributes = _ref2.attributes;\r\n        options.push({\r\n            offset: attributes.offset.value,\r\n            stopColor: attributes[\"stop-color\"].value\r\n        })\r\n    });\r\n    return options\r\n}\r\n\r\nfunction createFilter(element) {\r\n    var color;\r\n    var opacity;\r\n    var filterOptions = {};\r\n    (0, _iterator.each)(element.childNodes, function(_, node) {\r\n        var attr = node.attributes;\r\n        if (!attr.result) {\r\n            return\r\n        }\r\n        switch (attr.result.value) {\r\n            case \"gaussianBlurResult\":\r\n                filterOptions.blur = _number(attr.stdDeviation.value);\r\n                break;\r\n            case \"offsetResult\":\r\n                filterOptions.offsetX = _number(attr.dx.value);\r\n                filterOptions.offsetY = _number(attr.dy.value);\r\n                break;\r\n            case \"floodResult\":\r\n                color = attr[\"flood-color\"] ? attr[\"flood-color\"].value : \"#000\";\r\n                opacity = attr[\"flood-opacity\"] ? attr[\"flood-opacity\"].value : 1;\r\n                filterOptions.color = hex2rgba(color, opacity)\r\n        }\r\n    });\r\n    return filterOptions\r\n}\r\n\r\nfunction asyncEach(array, callback) {\r\n    var d = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : new _deferred.Deferred;\r\n    if (0 === array.length) {\r\n        return d.resolve()\r\n    }\r\n    var result = callback(array[0]);\r\n\r\n    function next() {\r\n        asyncEach(Array.prototype.slice.call(array, 1), callback, d)\r\n    }\r\n    if ((0, _type.isPromise)(result)) {\r\n        result.then(next)\r\n    } else {\r\n        next()\r\n    }\r\n    return d\r\n}\r\n\r\nfunction drawCanvasElements(elements, context, parentOptions, shared) {\r\n    return asyncEach(elements, function(element) {\r\n        switch (element.tagName && element.tagName.toLowerCase()) {\r\n            case \"g\":\r\n            case \"svg\":\r\n                var options = (0, _extend.extend)({}, parentOptions, getElementOptions(element, shared.rootAppended));\r\n                context.save();\r\n                transformElement(context, options);\r\n                clipElement(context, options, shared);\r\n                var onDone = function() {\r\n                    context.restore()\r\n                };\r\n                var d = drawCanvasElements(element.childNodes, context, options, shared);\r\n                if ((0, _type.isPromise)(d)) {\r\n                    d.then(onDone)\r\n                } else {\r\n                    onDone()\r\n                }\r\n                return d;\r\n            case \"defs\":\r\n                return drawCanvasElements(element.childNodes, context, {}, shared);\r\n            case \"clippath\":\r\n                shared.clipPaths[element.attributes.id.textContent] = element.childNodes[0];\r\n                break;\r\n            case \"pattern\":\r\n                shared.patterns[element.attributes.id.textContent] = element;\r\n                break;\r\n            case \"filter\":\r\n                shared.filters[element.id] = createFilter(element);\r\n                break;\r\n            case \"lineargradient\":\r\n                shared.gradients[element.attributes.id.textContent] = createGradient(element);\r\n                break;\r\n            default:\r\n                return drawElement(element, context, parentOptions, shared)\r\n        }\r\n    })\r\n}\r\n\r\nfunction setLineDash(context, options) {\r\n    var matches = options[\"stroke-dasharray\"] && options[\"stroke-dasharray\"].match(/(\\d+)/g);\r\n    if (matches && matches.length) {\r\n        matches = (0, _iterator.map)(matches, function(item) {\r\n            return _number(item)\r\n        });\r\n        context.setLineDash(matches)\r\n    }\r\n}\r\n\r\nfunction strokeElement(context, options, isText) {\r\n    var stroke = options.stroke;\r\n    if (stroke && \"none\" !== stroke && 0 !== options[\"stroke-width\"]) {\r\n        setLineDash(context, options);\r\n        context.lineJoin = options[\"stroke-linejoin\"];\r\n        context.lineWidth = options[\"stroke-width\"];\r\n        context.globalAlpha = options.strokeOpacity;\r\n        context.strokeStyle = stroke;\r\n        isText ? context.strokeText(options.text, options.x, options.y) : context.stroke();\r\n        context.globalAlpha = 1\r\n    }\r\n}\r\n\r\nfunction getPattern(context, pattern, shared) {\r\n    var options = getElementOptions(pattern, shared.rootAppended);\r\n    var patternCanvas = createCanvas(options.width, options.height, 0);\r\n    var patternContext = patternCanvas.getContext(\"2d\");\r\n    drawCanvasElements(pattern.childNodes, patternContext, options, shared);\r\n    return context.createPattern(patternCanvas, \"repeat\")\r\n}\r\n\r\nfunction fillElement(context, options, shared) {\r\n    var fill = options.fill;\r\n    if (fill && \"none\" !== fill) {\r\n        if (fill.search(/url/) === -1) {\r\n            context.fillStyle = fill\r\n        } else {\r\n            var pattern = shared.patterns[parseUrl(fill)];\r\n            if (!pattern) {\r\n                return\r\n            }\r\n            context.fillStyle = getPattern(context, pattern, shared)\r\n        }\r\n        context.globalAlpha = options.fillOpacity;\r\n        context.fill();\r\n        context.globalAlpha = 1\r\n    }\r\n}\r\nvar parseAttributes = function(attributes) {\r\n    var newAttributes = {};\r\n    var attr;\r\n    (0, _iterator.each)(attributes, function(index, item) {\r\n        attr = item.textContent;\r\n        if (isFinite(attr)) {\r\n            attr = _number(attr)\r\n        }\r\n        newAttributes[item.name.toLowerCase()] = attr\r\n    });\r\n    return newAttributes\r\n};\r\n\r\nfunction drawBackground(context, width, height, backgroundColor, margin) {\r\n    context.fillStyle = backgroundColor || \"#ffffff\";\r\n    context.fillRect(-margin, -margin, width + 2 * margin, height + 2 * margin)\r\n}\r\n\r\nfunction createInvisibleDiv() {\r\n    var invisibleDiv = _dom_adapter2.default.createElement(\"div\");\r\n    invisibleDiv.style.left = \"-9999px\";\r\n    invisibleDiv.style.position = \"absolute\";\r\n    return invisibleDiv\r\n}\r\n\r\nfunction convertSvgToCanvas(svg, canvas, rootAppended) {\r\n    return drawCanvasElements(svg.childNodes, canvas.getContext(\"2d\"), {}, {\r\n        clipPaths: {},\r\n        patterns: {},\r\n        filters: {},\r\n        gradients: {},\r\n        rootAppended: rootAppended\r\n    })\r\n}\r\n\r\nfunction getCanvasFromSvg(markup, width, height, backgroundColor, margin) {\r\n    var svgToCanvas = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : convertSvgToCanvas;\r\n    var canvas = createCanvas(width, height, margin);\r\n    var context = canvas.getContext(\"2d\");\r\n    var svgElem = _svg2.default.getSvgElement(markup);\r\n    var invisibleDiv;\r\n    var markupIsDomElement = _dom_adapter2.default.isElementNode(markup);\r\n    context.translate(margin, margin);\r\n    _dom_adapter2.default.getBody().appendChild(canvas);\r\n    if (!markupIsDomElement) {\r\n        invisibleDiv = createInvisibleDiv();\r\n        invisibleDiv.appendChild(svgElem);\r\n        _dom_adapter2.default.getBody().appendChild(invisibleDiv)\r\n    }\r\n    if (svgElem.attributes.direction) {\r\n        canvas.dir = svgElem.attributes.direction.textContent\r\n    }\r\n    drawBackground(context, width, height, backgroundColor, margin);\r\n    return (0, _deferred.fromPromise)(svgToCanvas(svgElem, canvas, markupIsDomElement && _dom2.default.contains(_dom_adapter2.default.getBody(), markup))).then(function() {\r\n        return canvas\r\n    }).always(function() {\r\n        invisibleDiv && _dom_adapter2.default.getBody().removeChild(invisibleDiv);\r\n        _dom_adapter2.default.getBody().removeChild(canvas)\r\n    })\r\n}\r\nexports.imageCreator = {\r\n    getImageData: function(markup, options) {\r\n        var mimeType = \"image/\" + options.format;\r\n        var width = options.width;\r\n        var height = options.height;\r\n        var backgroundColor = options.backgroundColor;\r\n        if ((0, _type.isFunction)(options.__parseAttributesFn)) {\r\n            parseAttributes = options.__parseAttributesFn\r\n        }\r\n        return getCanvasFromSvg(markup, width, height, backgroundColor, options.margin, options.svgToCanvas).then(function(canvas) {\r\n            return getStringFromCanvas(canvas, mimeType)\r\n        })\r\n    },\r\n    getData: function(markup, options) {\r\n        var that = this;\r\n        return exports.imageCreator.getImageData(markup, options).then(function(binaryData) {\r\n            var mimeType = \"image/\" + options.format;\r\n            var data = (0, _type.isFunction)(window.Blob) && !options.forceProxy ? that._getBlob(binaryData, mimeType) : that._getBase64(binaryData);\r\n            return data\r\n        })\r\n    },\r\n    _getBlob: function(binaryData, mimeType) {\r\n        var i;\r\n        var dataArray = new Uint8Array(binaryData.length);\r\n        for (i = 0; i < binaryData.length; i++) {\r\n            dataArray[i] = binaryData.charCodeAt(i)\r\n        }\r\n        return new window.Blob([dataArray.buffer], {\r\n            type: mimeType\r\n        })\r\n    },\r\n    _getBase64: function(binaryData) {\r\n        return window.btoa(binaryData)\r\n    }\r\n};\r\nexports.getData = function(data, options) {\r\n    return exports.imageCreator.getData(data, options)\r\n};\r\nexports.testFormats = function(formats) {\r\n    var canvas = createCanvas(100, 100, 0);\r\n    return formats.reduce(function(r, f) {\r\n        var mimeType = (\"image/\" + f).toLowerCase();\r\n        if (canvas.toDataURL(mimeType).indexOf(mimeType) !== -1) {\r\n            r.supported.push(f)\r\n        } else {\r\n            r.unsupported.push(f)\r\n        }\r\n        return r\r\n    }, {\r\n        supported: [],\r\n        unsupported: []\r\n    })\r\n};\r\n"]},"metadata":{},"sourceType":"script"}